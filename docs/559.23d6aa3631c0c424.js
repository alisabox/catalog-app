"use strict";(self.webpackChunkcatalog_app=self.webpackChunkcatalog_app||[]).push([[559],{1559:(ks,Ot,I)=>{I.d(Ot,{G:()=>Dt});var T=I(4004),et=I(515),f=I(3900),G=I(8996),q=I(5698),F=I(2122),E=I(4650),ge=(I(3692),I(259),I(5861)),ne=I(9681),ue=I(3475),u=I(2090),Lt=I(1877);const En="@firebase/database";let Mt="";function wn(n){Mt=n}class Ft{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),(0,u.Wl)(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:(0,u.cI)(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class pi{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return(0,u.r3)(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const In=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Ft(e)}}catch{}return new pi},De=In("localStorage"),Wt=In("sessionStorage"),Be=new Lt.Yd("@firebase/database"),Ut=function(){let n=1;return function(){return n++}}(),gt=function(n){const e=(0,u.dS)(n),t=new u.gQ;t.update(e);const i=t.digest();return u.US.encodeByteArray(i)},tt=function(...n){let e="";for(let t=0;t<n.length;t++){const i=n[t];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?e+=tt.apply(null,i):e+="object"==typeof i?(0,u.Wl)(i):i,e+=" "}return e};let Oe=null,mt=!0;const vt=function(n,e){(0,u.hu)(!e||!0===n||!1===n,"Can't turn on custom loggers persistently."),!0===n?(Be.logLevel=Lt.in.VERBOSE,Oe=Be.log.bind(Be),e&&Wt.set("logging_enabled",!0)):"function"==typeof n?Oe=n:(Oe=null,Wt.remove("logging_enabled"))},z=function(...n){if(!0===mt&&(mt=!1,null===Oe&&!0===Wt.get("logging_enabled")&&vt(!0)),Oe){const e=tt.apply(null,n);Oe(e)}},nt=function(n){return function(...e){z(n,...e)}},Ve=function(...n){const e="FIREBASE INTERNAL ERROR: "+tt(...n);Be.error(e)},ce=function(...n){const e=`FIREBASE FATAL ERROR: ${tt(...n)}`;throw Be.error(e),new Error(e)},j=function(...n){const e="FIREBASE WARNING: "+tt(...n);Be.warn(e)},it=function(n){return"number"==typeof n&&(n!=n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},Re="[MIN_NAME]",me="[MAX_NAME]",Le=function(n,e){if(n===e)return 0;if(n===Re||e===me)return-1;if(e===Re||n===me)return 1;{const t=Ct(n),i=Ct(e);return null!==t?null!==i?t-i==0?n.length-e.length:t-i:-1:null!==i?1:n<e?-1:1}},st=function(n,e){return n===e?0:n<e?-1:1},rt=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+(0,u.Wl)(e))},yt=function(n){if("object"!=typeof n||null===n)return(0,u.Wl)(n);const e=[];for(const i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)0!==i&&(t+=","),t+=(0,u.Wl)(e[i]),t+=":",t+=yt(n[e[i]]);return t+="}",t},Tn=function(n,e){const t=n.length;if(t<=e)return[n];const i=[];for(let s=0;s<t;s+=e)i.push(n.substring(s,s+e>t?t:s+e));return i};function $(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const Sn=function(n){(0,u.hu)(!it(n),"Invalid JSON number");const i=1023;let s,r,o,a,l;0===n?(r=0,o=0,s=1/n==-1/0?1:0):(s=n<0,(n=Math.abs(n))>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),r=a+i,o=Math.round(n*Math.pow(2,52-a)-Math.pow(2,52))):(r=0,o=Math.round(n/Math.pow(2,-1074))));const c=[];for(l=52;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=11;l;l-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(s?1:0),c.reverse();const _=c.join("");let g="";for(l=0;l<64;l+=8){let m=parseInt(_.substr(l,8),2).toString(16);1===m.length&&(m="0"+m),g+=m}return g.toLowerCase()},Vt=new RegExp("^-?(0*)\\d{1,10}$"),Ct=function(n){if(Vt.test(n)){const e=Number(n);if(e>=-2147483648&&e<=2147483647)return e}return null},Ge=function(n){try{n()}catch(e){setTimeout(()=>{throw j("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},ve=function(n,e){const t=setTimeout(n,e);return"number"==typeof t&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):"object"==typeof t&&t.unref&&t.unref(),t};class An{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){j(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Ci{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&"auth/token-not-initialized"===t.code?(z("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';e+="credential"in this.firebaseOptions_?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',j(e)}}let Me=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}return n.OWNER="owner",n})();const Ht=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,$t="websocket",Y="long_polling";class ot{constructor(e,t,i,s,r=!1,o="",a=!1){this.secure=t,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=De.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&De.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){return`${this.secure?"https://":"http://"}${this.host}/${this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:""}`}}function Dn(n,e,t){let i;if((0,u.hu)("string"==typeof e,"typeof type must == string"),(0,u.hu)("object"==typeof t,"typeof params must == object"),e===$t)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else{if(e!==Y)throw new Error("Unknown connection type: "+e);i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?"}(function Qt(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams})(n)&&(t.ns=n.namespace);const s=[];return $(t,(r,o)=>{s.push(r+"="+o)}),i+s.join("&")}class Ce{constructor(){this.counters_={}}incrementCounter(e,t=1){(0,u.r3)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return(0,u.p$)(this.counters_)}}const Fe={},Et={};function wt(n){const e=n.toString();return Fe[e]||(Fe[e]=new Ce),Fe[e]}class Kt{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&Ge(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class Ee{constructor(e,t,i,s,r,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=nt(e),this.stats_=wt(t),this.urlFn=l=>(this.appCheckToken&&(l.ac=this.appCheckToken),Dn(t,Y,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Kt(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(n){if((0,u.Yr)()||"complete"===document.readyState)n();else{let e=!1;const t=function(){document.body?e||(e=!0,n()):setTimeout(t,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&t()}),window.attachEvent("onload",t))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Si((...r)=>{const[o,a,l,c,_]=r;if(this.incrementIncomingBytes_(r),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===o)this.id=a,this.password=l;else{if("close"!==o)throw new Error("Unrecognized command received: "+o);a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_()}},(...r)=>{const[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const i={start:"t"};i.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(i.cb=this.scriptTagHolder.uniqueCallbackIdentifier),i.v="5",this.transportSessionId&&(i.s=this.transportSessionId),this.lastSessionId&&(i.ls=this.lastSessionId),this.applicationId&&(i.p=this.applicationId),this.appCheckToken&&(i.ac=this.appCheckToken),typeof location<"u"&&location.hostname&&Ht.test(location.hostname)&&(i.r="f");const s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Ee.forceAllow_=!0}static forceDisallow(){Ee.forceDisallow_=!0}static isAvailable(){return!((0,u.Yr)()||!Ee.forceAllow_&&(Ee.forceDisallow_||!(typeof document<"u")||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=(0,u.Wl)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=(0,u.h$)(t),s=Tn(i,1840);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if((0,u.Yr)())return;this.myDisconnFrame=document.createElement("iframe");const i={dframe:"t"};i.id=e,i.pw=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=(0,u.Wl)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Si{constructor(e,t,i,s){if(this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,u.Yr)())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=Ut(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=Si.createIFrame_();let r="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(r='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){z("frame writing exception"),a.stack&&z(a.stack),z(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||z("No IE domain setting required")}catch{const i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+i.length<=1870;){const o=this.pendingSegs.shift();i=i+"&seg"+s+"="+o.seg+"&ts"+s+"="+o.ts+"&d"+s+"="+o.d,s++}return t+=i,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(i,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(s),i()})}addTag(e,t){(0,u.Yr)()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){const s=i.readyState;(!s||"loaded"===s||"complete"===s)&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{z("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}let Ln=null;typeof MozWebSocket<"u"?Ln=MozWebSocket:typeof WebSocket<"u"&&(Ln=WebSocket);let It=(()=>{class n{constructor(t,i,s,r,o,a,l){this.connId=t,this.applicationId=s,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=nt(this.connId),this.stats_=wt(i),this.connURL=n.connectionURL_(i,a,l,r,s),this.nodeAdmin=i.nodeAdmin}static connectionURL_(t,i,s,r,o){const a={v:"5"};return!(0,u.Yr)()&&typeof location<"u"&&location.hostname&&Ht.test(location.hostname)&&(a.r="f"),i&&(a.s=i),s&&(a.ls=s),r&&(a.ac=r),o&&(a.p=o),Dn(t,$t,a)}open(t,i){this.onDisconnect=i,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,De.set("previous_websocket_failure",!0);try{let s;if((0,u.Yr)()){s={headers:{"User-Agent":`Firebase/5/${Mt}/${process.platform}/${this.nodeAdmin?"AdminNode":"Node"}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(s.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(s.headers["X-Firebase-AppCheck"]=this.appCheckToken);const o=process.env,a=0===this.connURL.indexOf("wss://")?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(s.proxy={origin:a})}this.mySock=new Ln(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const r=s.message||s.data;return r&&this.log_(r),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){const s=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);s&&s.length>1&&parseFloat(s[1])<4.4&&(t=!0)}return!t&&null!==Ln&&!n.forceDisallow_}static previouslyFailed(){return De.isInMemoryStorage||!0===De.get("previous_websocket_failure")}markConnectionHealthy(){De.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const i=this.frames.join("");this.frames=null;const s=(0,u.cI)(i);this.onMessage(s)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if((0,u.hu)(null===this.frames,"We already have a frame buffer"),t.length<=6){const i=Number(t);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(null===this.mySock)return;const i=t.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(i);else{const s=this.extractFrameCount_(i);null!==s&&this.appendFrame_(s)}}send(t){this.resetKeepAlive();const i=(0,u.Wl)(t);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);const s=Tn(i,16384);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(t){try{this.mySock.send(t)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4,n})(),xs=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[Ee,It]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){const i=It&&It.isAvailable();let s=i&&!It.previouslyFailed();if(t.webSocketOnly&&(i||j("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[It];else{const r=this.transports_=[];for(const o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&r.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}return n.globalTransportInitialized_=!1,n})();class Us{constructor(e,t,i,s,r,o,a,l,c,_){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=_,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=nt("c:"+this.id+":"),this.transportManager_=new xs(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=ve(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=rt("t",e),i=rt("d",e);if("c"===t)this.onSecondaryControl_(i);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(i)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=rt("t",e),i=rt("d",e);"c"===t?this.onControl_(i):"d"===t&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=rt("t",e);if("d"in e){const i=e.d;if("h"===t)this.onHandshake_(i);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(i):"r"===t?this.onReset_(i):"e"===t?Ve("Server Error: "+i):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Ve("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==i&&j("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),ve(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ve(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(De.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Bs{put(e,t,i,s){}merge(e,t,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}}class Vs{constructor(e){this.allowedEvents_=e,this.listeners_={},(0,u.hu)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});const s=this.getInitialEvent(e);s&&t.apply(i,s)}off(e,t,i){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===t&&(!i||i===s[r].context))return void s.splice(r,1)}validateEventType_(e){(0,u.hu)(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class Mn extends Vs{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!(0,u.uI)()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new Mn}getInitialEvent(e){return(0,u.hu)("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class O{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function D(){return new O("")}function R(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function ze(n){return n.pieces_.length-n.pieceNum_}function M(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new O(n.pieces_,e)}function Ri(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function jt(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function zs(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new O(e,0)}function B(n,e){const t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof O)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{const i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&t.push(i[s])}return new O(t,0)}function A(n){return n.pieceNum_>=n.pieces_.length}function ee(n,e){const t=R(n),i=R(e);if(null===t)return e;if(t===i)return ee(M(n),M(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function Yo(n,e){const t=jt(n,0),i=jt(e,0);for(let s=0;s<t.length&&s<i.length;s++){const r=Le(t[s],i[s]);if(0!==r)return r}return t.length===i.length?0:t.length<i.length?-1:1}function Ai(n,e){if(ze(n)!==ze(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function de(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(ze(n)>ze(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}class Zo{constructor(e,t){this.errorPrefix_=t,this.parts_=jt(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=(0,u.ug)(this.parts_[i]);$s(this)}}function $s(n){if(n.byteLength_>768)throw new Error(n.errorPrefix_+"has a key path longer than 768 bytes ("+n.byteLength_+").");if(n.parts_.length>32)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+at(n))}function at(n){return 0===n.parts_.length?"":"in property '"+n.parts_.join(".")+"'"}class Ni extends Vs{constructor(){let e,t;super(["visible"]),typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new Ni}getInitialEvent(e){return(0,u.hu)("visible"===e,"Unknown event type: "+e),[this.visible_]}}const Yt=1e3;let Wn,lt=(()=>{class n extends Bs{constructor(t,i,s,r,o,a,l,c){if(super(),this.repoInfo_=t,this.applicationId_=i,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=n.nextPersistentConnectionId_++,this.log_=nt("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Yt,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!(0,u.Yr)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Ni.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&Mn.getInstance().on("online",this.onOnline_,this)}sendRequest(t,i,s){const r=++this.requestNumber_,o={r,a:t,b:i};this.log_((0,u.Wl)(o)),(0,u.hu)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),s&&(this.requestCBHash_[r]=s)}get(t){this.initConnection_();const i=new u.BH,r={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{const l=a.d;"ok"===a.s?i.resolve(l):i.reject(l)}};return this.outstandingGets_.push(r),this.outstandingGetCount_++,this.connected_&&this.sendGet_(this.outstandingGets_.length-1),i.promise}listen(t,i,s,r){this.initConnection_();const o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),(0,u.hu)(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,u.hu)(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");const l={onComplete:r,hashFn:i,query:t,tag:s};this.listens.get(a).set(o,l),this.connected_&&this.sendListen_(l)}sendGet_(t){const i=this.outstandingGets_[t];this.sendRequest("g",i.request,s=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(s)})}sendListen_(t){const i=t.query,s=i._path.toString(),r=i._queryIdentifier;this.log_("Listen on "+s+" for "+r);const o={p:s};t.tag&&(o.q=i._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest("q",o,l=>{const c=l.d,_=l.s;n.warnOnListenWarnings_(c,i),(this.listens.get(s)&&this.listens.get(s).get(r))===t&&(this.log_("listen response",l),"ok"!==_&&this.removeListen_(s,r),t.onComplete&&t.onComplete(_,c))})}static warnOnListenWarnings_(t,i){if(t&&"object"==typeof t&&(0,u.r3)(t,"w")){const s=(0,u.DV)(t,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const r='".indexOn": "'+i._queryParams.getIndex().toString()+'"',o=i._path.toString();j(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&40===t.length||(0,u.GJ)(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,i=(0,u.w9)(t)?"auth":"gauth",s={cred:t};null===this.authOverride_?s.noauth=!0:"object"==typeof this.authOverride_&&(s.authvar=this.authOverride_),this.sendRequest(i,s,r=>{const o=r.s,a=r.d||"error";this.authToken_===t&&("ok"===o?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{const i=t.s,s=t.d||"error";"ok"===i?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,s)})}unlisten(t,i){const s=t._path.toString(),r=t._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),(0,u.hu)(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,t._queryObject,i)}sendUnlisten_(t,i,s,r){this.log_("Unlisten on "+t+" for "+i);const o={p:t};r&&(o.q=s,o.t=r),this.sendRequest("n",o)}onDisconnectPut(t,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,i,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:i,onComplete:s})}onDisconnectMerge(t,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,i,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:i,onComplete:s})}onDisconnectCancel(t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(t,i,s,r){const o={p:i,d:s};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{r&&setTimeout(()=>{r(a.s,a.d)},Math.floor(0))})}put(t,i,s,r){this.putInternal("p",t,i,s,r)}merge(t,i,s,r){this.putInternal("m",t,i,s,r)}putInternal(t,i,s,r,o){this.initConnection_();const a={p:i,d:s};void 0!==o&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:r}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+i)}sendPut_(t){const i=this.outstandingPuts_[t].action,s=this.outstandingPuts_[t].request,r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(i,s,o=>{this.log_(i+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(o.s,o.d)})}reportStats(t){if(this.connected_){const i={c:t};this.log_("reportStats",i),this.sendRequest("s",i,s=>{"ok"!==s.s&&this.log_("reportStats","Error sending stats: "+s.d)})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+(0,u.Wl)(t));const i=t.r,s=this.requestCBHash_[i];s&&(delete this.requestCBHash_[i],s(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,i){this.log_("handleServerMessage",t,i),"d"===t?this.onDataUpdate_(i.p,i.d,!1,i.t):"m"===t?this.onDataUpdate_(i.p,i.d,!0,i.t):"c"===t?this.onListenRevoked_(i.p,i.q):"ac"===t?this.onAuthRevoked_(i.s,i.d):"apc"===t?this.onAppCheckRevoked_(i.s,i.d):"sd"===t?this.onSecurityDebugPacket_(i):Ve("Unrecognized action received from server: "+(0,u.Wl)(t)+"\nAre you using the latest client?")}onReady_(t,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){(0,u.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Yt,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Yt,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Yt),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const t=(new Date).getTime()-this.lastConnectionAttemptTime_;let i=Math.max(0,this.reconnectDelay_-t);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}establishConnection_(){var t=this;return(0,ge.Z)(function*(){if(t.shouldReconnect_()){t.log_("Making a connection attempt"),t.lastConnectionAttemptTime_=(new Date).getTime(),t.lastConnectionEstablishedTime_=null;const i=t.onDataMessage_.bind(t),s=t.onReady_.bind(t),r=t.onRealtimeDisconnect_.bind(t),o=t.id+":"+n.nextConnectionId_++,a=t.lastSessionId;let l=!1,c=null;const _=function(){c?c.close():(l=!0,r())};t.realtime_={close:_,sendRequest:function(C){(0,u.hu)(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(C)}};const m=t.forceTokenRefresh_;t.forceTokenRefresh_=!1;try{const[C,w]=yield Promise.all([t.authTokenProvider_.getToken(m),t.appCheckTokenProvider_.getToken(m)]);l?z("getToken() completed but was canceled"):(z("getToken() completed. Creating connection."),t.authToken_=C&&C.accessToken,t.appCheckToken_=w&&w.token,c=new Us(o,t.repoInfo_,t.applicationId_,t.appCheckToken_,t.authToken_,i,s,r,N=>{j(N+" ("+t.repoInfo_.toString()+")"),t.interrupt("server_kill")},a))}catch(C){t.log_("Failed to get token: "+C),l||(t.repoInfo_.nodeAdmin&&j(C),_())}}})()}interrupt(t){z("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){z("Resuming connection for reason: "+t),delete this.interruptReasons_[t],(0,u.xb)(this.interruptReasons_)&&(this.reconnectDelay_=Yt,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const i=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const i=this.outstandingPuts_[t];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(t,i){let s;s=i?i.map(o=>yt(o)).join("$"):"default";const r=this.removeListen_(t,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(t,i){const s=new O(t).toString();let r;if(this.listens.has(s)){const o=this.listens.get(s);r=o.get(i),o.delete(i),0===o.size&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(t,i){z("Auth token revoked: "+t+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===t||"permission_denied"===t)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,i){z("App check token revoked: "+t+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===t||"permission_denied"===t)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const i of t.values())this.sendListen_(i);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let i="js";(0,u.Yr)()&&(i=this.repoInfo_.nodeAdmin?"admin_node":"node"),t["sdk."+i+"."+Mt.replace(/\./g,"-")]=1,(0,u.uI)()?t["framework.cordova"]=1:(0,u.b$)()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=Mn.getInstance().currentlyOnline();return(0,u.xb)(this.interruptReasons_)&&t}}return n.nextPersistentConnectionId_=0,n.nextConnectionId_=0,n})();class P{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new P(e,t)}}class Fn{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const i=new P(Re,e),s=new P(Re,t);return 0!==this.compare(i,s)}minPost(){return P.MIN}}class js extends Fn{static get __EMPTY_NODE(){return Wn}static set __EMPTY_NODE(e){Wn=e}compare(e,t){return Le(e.name,t.name)}isDefinedOn(e){throw(0,u.g5)("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return P.MIN}maxPost(){return new P(me,Wn)}makePost(e,t){return(0,u.hu)("string"==typeof e,"KeyIndex indexValue must always be a string."),new P(e,Wn)}toString(){return".key"}}const Ne=new js;class Un{constructor(e,t,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(o=t?i(e.key,t):1,s&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else{if(0===o){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}let ki,we=(()=>{class n{constructor(t,i,s,r,o){this.key=t,this.value=i,this.color=s??n.RED,this.left=r??se.EMPTY_NODE,this.right=o??se.EMPTY_NODE}copy(t,i,s,r,o){return new n(t??this.key,i??this.value,s??this.color,r??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,s){let r=this;const o=s(t,r.key);return r=o<0?r.copy(null,null,null,r.left.insert(t,i,s),null):0===o?r.copy(null,i,null,null,null):r.copy(null,null,null,null,r.right.insert(t,i,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return se.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,i){let s,r;if(s=this,i(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(t,i),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),0===i(t,s.key)){if(s.right.isEmpty())return se.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(t,i))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})();class se{constructor(e,t=se.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new se(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,we.BLACK,null,null))}remove(e){return new se(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,we.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),0===t)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,s=null;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),0===t){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}t<0?i=i.left:t>0&&(s=i,i=i.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Un(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Un(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Un(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Un(this.root_,null,this.comparator_,!0,e)}}function sa(n,e){return Le(n.name,e.name)}function Pi(n,e){return Le(n,e)}se.EMPTY_NODE=new class ia{copy(e,t,i,s,r){return this}insert(e,t,i){return new we(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const Ys=function(n){return"number"==typeof n?"number:"+Sn(n):"string:"+n},Zs=function(n){if(n.isLeafNode()){const e=n.val();(0,u.hu)("string"==typeof e||"number"==typeof e||"object"==typeof e&&(0,u.r3)(e,".sv"),"Priority must be a string or number.")}else(0,u.hu)(n===ki||n.isEmpty(),"priority of unexpected type.");(0,u.hu)(n===ki||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let qs,Xs,Js,Tt=(()=>{class n{constructor(t,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=i,this.lazyHash_=null,(0,u.hu)(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),Zs(this.priorityNode_)}static set __childrenNodeConstructor(t){qs=t}static get __childrenNodeConstructor(){return qs}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return A(t)?this:".priority"===R(t)?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,i){return null}updateImmediateChild(t,i){return".priority"===t?this.updatePriority(i):i.isEmpty()&&".priority"!==t?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,i).updatePriority(this.priorityNode_)}updateChild(t,i){const s=R(t);return null===s?i:i.isEmpty()&&".priority"!==s?this:((0,u.hu)(".priority"!==s||1===ze(t),".priority must be the last token in a path"),this.updateImmediateChild(s,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(M(t),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,i){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+Ys(this.priorityNode_.val())+":");const i=typeof this.value_;t+=i+":",t+="number"===i?Sn(this.value_):this.value_,this.lazyHash_=gt(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:((0,u.hu)(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const i=typeof t.value_,s=typeof this.value_,r=n.VALUE_TYPE_ORDER.indexOf(i),o=n.VALUE_TYPE_ORDER.indexOf(s);return(0,u.hu)(r>=0,"Unknown leaf type: "+i),(0,u.hu)(o>=0,"Unknown leaf type: "+s),r===o?"object"===s?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){const i=t;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}return!1}}return n.VALUE_TYPE_ORDER=["object","boolean","number","string"],n})();const W=new class la extends Fn{compare(e,t){const i=e.node.getPriority(),s=t.node.getPriority(),r=i.compareTo(s);return 0===r?Le(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return P.MIN}maxPost(){return new P(me,new Tt("[PRIORITY-POST]",Js))}makePost(e,t){const i=Xs(e);return new P(t,new Tt("[PRIORITY-POST]",i))}toString(){return".priority"}},ua=Math.log(2);class ca{constructor(e){this.count=parseInt(Math.log(e+1)/ua,10),this.current_=this.count-1;const s=(r=>parseInt(Array(this.count+1).join("1"),2))();this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Bn=function(n,e,t,i){n.sort(e);const s=function(l,c){const _=c-l;let g,m;if(0===_)return null;if(1===_)return g=n[l],m=t?t(g):g,new we(m,g.node,we.BLACK,null,null);{const C=parseInt(_/2,10)+l,w=s(l,C),N=s(C+1,c);return g=n[C],m=t?t(g):g,new we(m,g.node,we.BLACK,w,N)}},a=function(l){let c=null,_=null,g=n.length;const m=function(w,N){const V=g-w,te=g;g-=w;const le=s(V+1,te),xe=n[V],Q=t?t(xe):xe;C(new we(Q,xe.node,N,null,le))},C=function(w){c?(c.left=w,c=w):(_=w,c=w)};for(let w=0;w<l.count;++w){const N=l.nextBitIsOne(),V=Math.pow(2,l.count-(w+1));N?m(V,we.BLACK):(m(V,we.BLACK),m(V,we.RED))}return _}(new ca(n.length));return new se(i||e,a)};let xi;const St={};class We{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return(0,u.hu)(St&&W,"ChildrenNode.ts has not been loaded"),xi=xi||new We({".priority":St},{".priority":W}),xi}get(e){const t=(0,u.DV)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof se?t:null}hasIndex(e){return(0,u.r3)(this.indexSet_,e.toString())}addIndex(e,t){(0,u.hu)(e!==Ne,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let s=!1;const r=t.getIterator(P.Wrap);let a,o=r.getNext();for(;o;)s=s||e.isDefinedOn(o.node),i.push(o),o=r.getNext();a=s?Bn(i,e.getCompare()):St;const l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;const _=Object.assign({},this.indexes_);return _[l]=a,new We(_,c)}addToIndexes(e,t){const i=(0,u.UI)(this.indexes_,(s,r)=>{const o=(0,u.DV)(this.indexSet_,r);if((0,u.hu)(o,"Missing index implementation for "+r),s===St){if(o.isDefinedOn(e.node)){const a=[],l=t.getIterator(P.Wrap);let c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),Bn(a,o.getCompare())}return St}{const a=t.get(e.name);let l=s;return a&&(l=l.remove(new P(e.name,a))),l.insert(e,e.node)}});return new We(i,this.indexSet_)}removeFromIndexes(e,t){const i=(0,u.UI)(this.indexes_,s=>{if(s===St)return s;{const r=t.get(e.name);return r?s.remove(new P(e.name,r)):s}});return new We(i,this.indexSet_)}}let Zt,S=(()=>{class n{constructor(t,i,s){this.children_=t,this.priorityNode_=i,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&Zs(this.priorityNode_),this.children_.isEmpty()&&(0,u.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Zt||(Zt=new n(new se(Pi),null,We.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Zt}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(".priority"===t)return this.getPriority();{const i=this.children_.get(t);return null===i?Zt:i}}getChild(t){const i=R(t);return null===i?this:this.getImmediateChild(i).getChild(M(t))}hasChild(t){return null!==this.children_.get(t)}updateImmediateChild(t,i){if((0,u.hu)(i,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(i);{const s=new P(t,i);let r,o;i.isEmpty()?(r=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(t,i),o=this.indexMap_.addToIndexes(s,this.children_));const a=r.isEmpty()?Zt:this.priorityNode_;return new n(r,a,o)}}updateChild(t,i){const s=R(t);if(null===s)return i;{(0,u.hu)(".priority"!==R(t)||1===ze(t),".priority must be the last token in a path");const r=this.getImmediateChild(s).updateChild(M(t),i);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const i={};let s=0,r=0,o=!0;if(this.forEachChild(W,(a,l)=>{i[a]=l.val(t),s++,o&&n.INTEGER_REGEXP_.test(a)?r=Math.max(r,Number(a)):o=!1}),!t&&o&&r<2*s){const a=[];for(const l in i)a[l]=i[l];return a}return t&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(null===this.lazyHash_){let t="";this.getPriority().isEmpty()||(t+="priority:"+Ys(this.getPriority().val())+":"),this.forEachChild(W,(i,s)=>{const r=s.hash();""!==r&&(t+=":"+i+":"+r)}),this.lazyHash_=""===t?"":gt(t)}return this.lazyHash_}getPredecessorChildName(t,i,s){const r=this.resolveIndex_(s);if(r){const o=r.getPredecessorKey(new P(t,i));return o?o.name:null}return this.children_.getPredecessorKey(t)}getFirstChildName(t){const i=this.resolveIndex_(t);if(i){const s=i.minKey();return s&&s.name}return this.children_.minKey()}getFirstChild(t){const i=this.getFirstChildName(t);return i?new P(i,this.children_.get(i)):null}getLastChildName(t){const i=this.resolveIndex_(t);if(i){const s=i.maxKey();return s&&s.name}return this.children_.maxKey()}getLastChild(t){const i=this.getLastChildName(t);return i?new P(i,this.children_.get(i)):null}forEachChild(t,i){const s=this.resolveIndex_(t);return s?s.inorderTraversal(r=>i(r.name,r.node)):this.children_.inorderTraversal(i)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,i){const s=this.resolveIndex_(i);if(s)return s.getIteratorFrom(t,r=>r);{const r=this.children_.getIteratorFrom(t.name,P.Wrap);let o=r.peek();for(;null!=o&&i.compare(o,t)<0;)r.getNext(),o=r.peek();return r}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,i){const s=this.resolveIndex_(i);if(s)return s.getReverseIteratorFrom(t,r=>r);{const r=this.children_.getReverseIteratorFrom(t.name,P.Wrap);let o=r.peek();for(;null!=o&&i.compare(o,t)>0;)r.getNext(),o=r.peek();return r}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===qt?-1:0}withIndex(t){if(t===Ne||this.indexMap_.hasIndex(t))return this;{const i=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(t){return t===Ne||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const i=t;if(this.getPriority().equals(i.getPriority())){if(this.children_.count()===i.children_.count()){const s=this.getIterator(W),r=i.getIterator(W);let o=s.getNext(),a=r.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=s.getNext(),a=r.getNext()}return null===o&&null===a}return!1}return!1}}resolveIndex_(t){return t===Ne?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})();const qt=new class ha extends S{constructor(){super(new se(Pi),S.EMPTY_NODE,We.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return S.EMPTY_NODE}isEmpty(){return!1}};function H(n,e=null){if(null===n)return S.EMPTY_NODE;if("object"==typeof n&&".priority"in n&&(e=n[".priority"]),(0,u.hu)(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof n&&".value"in n&&null!==n[".value"]&&(n=n[".value"]),"object"!=typeof n||".sv"in n)return new Tt(n,H(e));if(n instanceof Array){let t=S.EMPTY_NODE;return $(n,(i,s)=>{if((0,u.r3)(n,i)&&"."!==i.substring(0,1)){const r=H(s);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(i,r))}}),t.updatePriority(H(e))}{const t=[];let i=!1;if($(n,(o,a)=>{if("."!==o.substring(0,1)){const l=H(a);l.isEmpty()||(i=i||!l.getPriority().isEmpty(),t.push(new P(o,l)))}}),0===t.length)return S.EMPTY_NODE;const r=Bn(t,sa,o=>o.name,Pi);if(i){const o=Bn(t,W.getCompare());return new S(r,H(e),new We({".priority":o},{".priority":W}))}return new S(r,H(e),We.Default)}}Object.defineProperties(P,{MIN:{value:new P(Re,S.EMPTY_NODE)},MAX:{value:new P(me,qt)}}),js.__EMPTY_NODE=S.EMPTY_NODE,Tt.__childrenNodeConstructor=S,function ra(n){ki=n}(qt),function aa(n){Js=n}(qt),function oa(n){Xs=n}(H);class Di extends Fn{constructor(e){super(),this.indexPath_=e,(0,u.hu)(!A(e)&&".priority"!==R(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const i=this.extractChild(e.node),s=this.extractChild(t.node),r=i.compareTo(s);return 0===r?Le(e.name,t.name):r}makePost(e,t){const i=H(e),s=S.EMPTY_NODE.updateChild(this.indexPath_,i);return new P(t,s)}maxPost(){const e=S.EMPTY_NODE.updateChild(this.indexPath_,qt);return new P(me,e)}toString(){return jt(this.indexPath_,0).join("/")}}const Oi=new class fa extends Fn{compare(e,t){const i=e.node.compareTo(t.node);return 0===i?Le(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return P.MIN}maxPost(){return P.MAX}makePost(e,t){const i=H(e);return new P(t,i)}toString(){return".value"}};function er(n){return{type:"value",snapshotNode:n}}function bt(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Xt(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Jt(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}class Li{constructor(e){this.index_=e}updateChild(e,t,i,s,r,o){(0,u.hu)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()||(null!=o&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(Xt(t,a)):(0,u.hu)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(bt(t,i)):o.trackChildChange(Jt(t,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return null!=i&&(e.isLeafNode()||e.forEachChild(W,(s,r)=>{t.hasChild(s)||i.trackChildChange(Xt(s,r))}),t.isLeafNode()||t.forEachChild(W,(s,r)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(r)||i.trackChildChange(Jt(s,r,o))}else i.trackChildChange(bt(s,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?S.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class en{constructor(e){this.indexedFilter_=new Li(e.getIndex()),this.index_=e.getIndex(),this.startPost_=en.getStartPost_(e),this.endPost_=en.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&i}updateChild(e,t,i,s,r,o){return this.matches(new P(t,i))||(i=S.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,s,r,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=S.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(S.EMPTY_NODE);const r=this;return t.forEachChild(W,(o,a)=>{r.matches(new P(o,a))||(s=s.updateImmediateChild(o,S.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class pa{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{const i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new en(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,s,r,o){return this.rangedFilter_.matches(new P(t,i))||(i=S.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,s,r,o):this.fullLimitUpdateChild_(e,t,i,r,o)}updateFullNode(e,t,i){let s;if(t.isLeafNode()||t.isEmpty())s=S.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let r;s=S.EMPTY_NODE.withIndex(this.index_),r=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){const a=r.getNext();if(this.withinDirectionalStart(a)){if(!this.withinDirectionalEnd(a))break;s=s.updateImmediateChild(a.name,a.node),o++}}}else{let r;s=t.withIndex(this.index_),s=s.updatePriority(S.EMPTY_NODE),r=this.reverse_?s.getReverseIterator(this.index_):s.getIterator(this.index_);let o=0;for(;r.hasNext();){const a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,S.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,s,r){let o;if(this.reverse_){const g=this.index_.getCompare();o=(m,C)=>g(C,m)}else o=this.index_.getCompare();const a=e;(0,u.hu)(a.numChildren()===this.limit_,"");const l=new P(t,i),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),_=this.rangedFilter_.matches(l);if(a.hasChild(t)){const g=a.getImmediateChild(t);let m=s.getChildAfterChild(this.index_,c,this.reverse_);for(;null!=m&&(m.name===t||a.hasChild(m.name));)m=s.getChildAfterChild(this.index_,m,this.reverse_);const C=null==m?1:o(m,l);if(_&&!i.isEmpty()&&C>=0)return r?.trackChildChange(Jt(t,i,g)),a.updateImmediateChild(t,i);{r?.trackChildChange(Xt(t,g));const N=a.updateImmediateChild(t,S.EMPTY_NODE);return null!=m&&this.rangedFilter_.matches(m)?(r?.trackChildChange(bt(m.name,m.node)),N.updateImmediateChild(m.name,m.node)):N}}return i.isEmpty()?e:_&&o(c,l)>=0?(null!=r&&(r.trackChildChange(Xt(c.name,c.node)),r.trackChildChange(bt(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(c.name,S.EMPTY_NODE)):e}}class Vn{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=W}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return(0,u.hu)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(0,u.hu)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Re}hasEnd(){return this.endSet_}getIndexEndValue(){return(0,u.hu)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(0,u.hu)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:me}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return(0,u.hu)(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===W}copy(){const e=new Vn;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Mi(n,e,t){const i=n.copy();return i.startSet_=!0,void 0===e&&(e=null),i.indexStartValue_=e,null!=t?(i.startNameSet_=!0,i.indexStartName_=t):(i.startNameSet_=!1,i.indexStartName_=""),i}function Fi(n,e,t){const i=n.copy();return i.endSet_=!0,void 0===e&&(e=null),i.indexEndValue_=e,void 0!==t?(i.endNameSet_=!0,i.indexEndName_=t):(i.endNameSet_=!1,i.indexEndName_=""),i}function Gn(n,e){const t=n.copy();return t.index_=e,t}function tr(n){const e={};if(n.isDefault())return e;let t;if(n.index_===W?t="$priority":n.index_===Oi?t="$value":n.index_===Ne?t="$key":((0,u.hu)(n.index_ instanceof Di,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=(0,u.Wl)(t),n.startSet_){const i=n.startAfterSet_?"startAfter":"startAt";e[i]=(0,u.Wl)(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+(0,u.Wl)(n.indexStartName_))}if(n.endSet_){const i=n.endBeforeSet_?"endBefore":"endAt";e[i]=(0,u.Wl)(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+(0,u.Wl)(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function nr(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;""===t&&(t=n.isViewFromLeft()?"l":"r"),e.vf=t}return n.index_!==W&&(e.i=n.index_.toString()),e}class Hn extends Bs{constructor(e,t,i,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=nt("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:((0,u.hu)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,i,s){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=Hn.getListenId_(e,i),a={};this.listens_[o]=a;const l=tr(e._queryParams);this.restRequest_(r+".json",l,(c,_)=>{let g=_;if(404===c&&(g=null,c=null),null===c&&this.onDataUpdate_(r,g,!1,i),(0,u.DV)(this.listens_,o)===a){let m;m=c?401===c?"permission_denied":"rest_error:"+c:"ok",s(m,null)}})}unlisten(e,t){const i=Hn.getListenId_(e,t);delete this.listens_[i]}get(e){const t=tr(e._queryParams),i=e._path.toString(),s=new u.BH;return this.restRequest_(i+".json",t,(r,o)=>{let a=o;404===r&&(a=null,r=null),null===r?(this.onDataUpdate_(i,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(t.auth=s.accessToken),r&&r.token&&(t.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+(0,u.xO)(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&4===a.readyState){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=(0,u.cI)(a.responseText)}catch{j("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,l)}else 401!==a.status&&404!==a.status&&j("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}}class Ea{constructor(){this.rootNode_=S.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function zn(){return{value:null,children:new Map}}function Rt(n,e,t){if(A(e))n.value=t,n.children.clear();else if(null!==n.value)n.value=n.value.updateChild(e,t);else{const i=R(e);n.children.has(i)||n.children.set(i,zn()),Rt(n.children.get(i),e=M(e),t)}}function Wi(n,e){if(A(e))return n.value=null,n.children.clear(),!0;if(null!==n.value){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(W,(i,s)=>{Rt(n,new O(i),s)}),Wi(n,e)}}if(n.children.size>0){const t=R(e);return e=M(e),n.children.has(t)&&Wi(n.children.get(t),e)&&n.children.delete(t),0===n.children.size}return!0}function Ui(n,e,t){null!==n.value?t(e,n.value):function wa(n,e){n.children.forEach((t,i)=>{e(i,t)})}(n,(i,s)=>{Ui(s,new O(e.toString()+"/"+i),t)})}class Ia{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&$(this.last_,(i,s)=>{t[i]=t[i]-s}),this.last_=e,t}}class ba{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Ia(e);const i=1e4+2e4*Math.random();ve(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const e=this.statsListener_.get(),t={};let i=!1;$(e,(s,r)=>{r>0&&(0,u.r3)(this.statsToReport_,s)&&(t[s]=r,i=!0)}),i&&this.server_.reportStats(t),ve(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var fe=(()=>{return(n=fe||(fe={}))[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",fe;var n})();function Gi(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class $n{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=fe.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(A(this.path)){if(null!=this.affectedTree.value)return(0,u.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new O(e));return new $n(D(),t,this.revert)}}return(0,u.hu)(R(this.path)===e,"operationForChild called for unrelated child."),new $n(M(this.path),this.affectedTree,this.revert)}}class tn{constructor(e,t){this.source=e,this.path=t,this.type=fe.LISTEN_COMPLETE}operationForChild(e){return A(this.path)?new tn(this.source,D()):new tn(this.source,M(this.path))}}class ut{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=fe.OVERWRITE}operationForChild(e){return A(this.path)?new ut(this.source,D(),this.snap.getImmediateChild(e)):new ut(this.source,M(this.path),this.snap)}}class At{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=fe.MERGE}operationForChild(e){if(A(this.path)){const t=this.children.subtree(new O(e));return t.isEmpty()?null:t.value?new ut(this.source,D(),t.value):new At(this.source,D(),t)}return(0,u.hu)(R(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new At(this.source,M(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class $e{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(A(e))return this.isFullyInitialized()&&!this.filtered_;const t=R(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Ra{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function nn(n,e,t,i,s,r){const o=i.filter(a=>a.type===t);o.sort((a,l)=>function Pa(n,e,t){if(null==e.childName||null==t.childName)throw(0,u.g5)("Should only compare child_ events.");const i=new P(e.childName,e.snapshotNode),s=new P(t.childName,t.snapshotNode);return n.index_.compare(i,s)}(n,a,l)),o.forEach(a=>{const l=function Na(n,e,t){return"value"===e.type||"child_removed"===e.type||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}(n,a,r);s.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,n.query_))})})}function Qn(n,e){return{eventCache:n,serverCache:e}}function sn(n,e,t,i){return Qn(new $e(e,t,i),n.serverCache)}function sr(n,e,t,i){return Qn(n.eventCache,new $e(e,t,i))}function Kn(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function ct(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let Hi;class U{constructor(e,t=(()=>(Hi||(Hi=new se(st)),Hi))()){this.value=e,this.children=t}static fromObject(e){let t=new U(null);return $(e,(i,s)=>{t=t.set(new O(i),s)}),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:D(),value:this.value};if(A(e))return null;{const i=R(e),s=this.children.get(i);if(null!==s){const r=s.findRootMostMatchingPathAndValue(M(e),t);return null!=r?{path:B(new O(i),r.path),value:r.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(A(e))return this;{const t=R(e),i=this.children.get(t);return null!==i?i.subtree(M(e)):new U(null)}}set(e,t){if(A(e))return new U(t,this.children);{const i=R(e),r=(this.children.get(i)||new U(null)).set(M(e),t),o=this.children.insert(i,r);return new U(this.value,o)}}remove(e){if(A(e))return this.children.isEmpty()?new U(null):new U(null,this.children);{const t=R(e),i=this.children.get(t);if(i){const s=i.remove(M(e));let r;return r=s.isEmpty()?this.children.remove(t):this.children.insert(t,s),null===this.value&&r.isEmpty()?new U(null):new U(this.value,r)}return this}}get(e){if(A(e))return this.value;{const t=R(e),i=this.children.get(t);return i?i.get(M(e)):null}}setTree(e,t){if(A(e))return t;{const i=R(e),r=(this.children.get(i)||new U(null)).setTree(M(e),t);let o;return o=r.isEmpty()?this.children.remove(i):this.children.insert(i,r),new U(this.value,o)}}fold(e){return this.fold_(D(),e)}fold_(e,t){const i={};return this.children.inorderTraversal((s,r)=>{i[s]=r.fold_(B(e,s),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,D(),t)}findOnPath_(e,t,i){const s=!!this.value&&i(t,this.value);if(s)return s;if(A(e))return null;{const r=R(e),o=this.children.get(r);return o?o.findOnPath_(M(e),B(t,r),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,D(),t)}foreachOnPath_(e,t,i){if(A(e))return this;{this.value&&i(t,this.value);const s=R(e),r=this.children.get(s);return r?r.foreachOnPath_(M(e),B(t,s),i):new U(null)}}foreach(e){this.foreach_(D(),e)}foreach_(e,t){this.children.inorderTraversal((i,s)=>{s.foreach_(B(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}}class Ie{constructor(e){this.writeTree_=e}static empty(){return new Ie(new U(null))}}function rn(n,e,t){if(A(e))return new Ie(new U(t));{const i=n.writeTree_.findRootMostValueAndPath(e);if(null!=i){const s=i.path;let r=i.value;const o=ee(s,e);return r=r.updateChild(o,t),new Ie(n.writeTree_.set(s,r))}{const s=new U(t),r=n.writeTree_.setTree(e,s);return new Ie(r)}}}function zi(n,e,t){let i=n;return $(t,(s,r)=>{i=rn(i,B(e,s),r)}),i}function rr(n,e){if(A(e))return Ie.empty();{const t=n.writeTree_.setTree(e,new U(null));return new Ie(t)}}function $i(n,e){return null!=ht(n,e)}function ht(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return null!=t?n.writeTree_.get(t.path).getChild(ee(t.path,e)):null}function or(n){const e=[],t=n.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(W,(i,s)=>{e.push(new P(i,s))}):n.writeTree_.children.inorderTraversal((i,s)=>{null!=s.value&&e.push(new P(i,s.value))}),e}function Qe(n,e){if(A(e))return n;{const t=ht(n,e);return new Ie(null!=t?new U(t):n.writeTree_.subtree(e))}}function Qi(n){return n.writeTree_.isEmpty()}function Nt(n,e){return ar(D(),n.writeTree_,e)}function ar(n,e,t){if(null!=e.value)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((s,r)=>{".priority"===s?((0,u.hu)(null!==r.value,"Priority writes must always be leaf nodes"),i=r.value):t=ar(B(n,s),r,t)}),!t.getChild(n).isEmpty()&&null!==i&&(t=t.updateChild(B(n,".priority"),i)),t}}function jn(n,e){return dr(e,n)}function Ma(n,e){if(n.snap)return de(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&de(B(n.path,t),e))return!0;return!1}function Wa(n){return n.visible}function lr(n,e,t){let i=Ie.empty();for(let s=0;s<n.length;++s){const r=n[s];if(e(r)){const o=r.path;let a;if(r.snap)de(t,o)?(a=ee(t,o),i=rn(i,a,r.snap)):de(o,t)&&(a=ee(o,t),i=rn(i,D(),r.snap.getChild(a)));else{if(!r.children)throw(0,u.g5)("WriteRecord should have .snap or .children");if(de(t,o))a=ee(t,o),i=zi(i,a,r.children);else if(de(o,t))if(a=ee(o,t),A(a))i=zi(i,D(),r.children);else{const l=(0,u.DV)(r.children,R(a));if(l){const c=l.getChild(M(a));i=rn(i,D(),c)}}}}}return i}function ur(n,e,t,i,s){if(i||s){const r=Qe(n.visibleWrites,e);return!s&&Qi(r)?t:s||null!=t||$i(r,D())?Nt(lr(n.allWrites,function(c){return(c.visible||s)&&(!i||!~i.indexOf(c.writeId))&&(de(c.path,e)||de(e,c.path))},e),t||S.EMPTY_NODE):null}{const r=ht(n.visibleWrites,e);if(null!=r)return r;{const o=Qe(n.visibleWrites,e);return Qi(o)?t:null!=t||$i(o,D())?Nt(o,t||S.EMPTY_NODE):null}}}function Yn(n,e,t,i){return ur(n.writeTree,n.treePath,e,t,i)}function Ki(n,e){return function Ua(n,e,t){let i=S.EMPTY_NODE;const s=ht(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(W,(r,o)=>{i=i.updateImmediateChild(r,o)}),i;if(t){const r=Qe(n.visibleWrites,e);return t.forEachChild(W,(o,a)=>{const l=Nt(Qe(r,new O(o)),a);i=i.updateImmediateChild(o,l)}),or(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}return or(Qe(n.visibleWrites,e)).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}(n.writeTree,n.treePath,e)}function cr(n,e,t,i){return function Ba(n,e,t,i,s){(0,u.hu)(i||s,"Either existingEventSnap or existingServerSnap must exist");const r=B(e,t);if($i(n.visibleWrites,r))return null;{const o=Qe(n.visibleWrites,r);return Qi(o)?s.getChild(t):Nt(o,s.getChild(t))}}(n.writeTree,n.treePath,e,t,i)}function Zn(n,e){return function Ga(n,e){return ht(n.visibleWrites,e)}(n.writeTree,B(n.treePath,e))}function ji(n,e,t){return function Va(n,e,t,i){const s=B(e,t),r=ht(n.visibleWrites,s);return null!=r?r:i.isCompleteForChild(t)?Nt(Qe(n.visibleWrites,s),i.getNode().getImmediateChild(t)):null}(n.writeTree,n.treePath,e,t)}function hr(n,e){return dr(B(n.treePath,e),n.writeTree)}function dr(n,e){return{treePath:n,writeTree:e}}class Qa{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,i=e.childName;(0,u.hu)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),(0,u.hu)(".priority"!==i,"Only non-priority child changes can be tracked.");const s=this.changeMap.get(i);if(s){const r=s.type;if("child_added"===t&&"child_removed"===r)this.changeMap.set(i,Jt(i,e.snapshotNode,s.snapshotNode));else if("child_removed"===t&&"child_added"===r)this.changeMap.delete(i);else if("child_removed"===t&&"child_changed"===r)this.changeMap.set(i,Xt(i,s.oldSnap));else if("child_changed"===t&&"child_added"===r)this.changeMap.set(i,bt(i,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==r)throw(0,u.g5)("Illegal combination of changes: "+e+" occurred after "+s);this.changeMap.set(i,Jt(i,e.snapshotNode,s.oldSnap))}}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}const fr=new class Ka{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}};class Yi{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const i=null!=this.optCompleteServerCache_?new $e(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return ji(this.writes_,e,i)}}getChildAfterChild(e,t,i){const s=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:ct(this.viewCache_),r=function $a(n,e,t,i,s,r){return function Ha(n,e,t,i,s,r,o){let a;const l=Qe(n.visibleWrites,e),c=ht(l,D());if(null!=c)a=c;else{if(null==t)return[];a=Nt(l,t)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const _=[],g=o.getCompare(),m=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let C=m.getNext();for(;C&&_.length<s;)0!==g(C,i)&&_.push(C),C=m.getNext();return _}}(n.writeTree,n.treePath,e,t,i,s,r)}(this.writes_,s,t,1,i,e);return 0===r.length?null:r[0]}}function _r(n,e,t,i,s,r){const o=e.eventCache;if(null!=Zn(i,t))return e;{let a,l;if(A(t))if((0,u.hu)(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const c=ct(e),g=Ki(i,c instanceof S?c:S.EMPTY_NODE);a=n.filter.updateFullNode(e.eventCache.getNode(),g,r)}else{const c=Yn(i,ct(e));a=n.filter.updateFullNode(e.eventCache.getNode(),c,r)}else{const c=R(t);if(".priority"===c){(0,u.hu)(1===ze(t),"Can't have a priority with additional path components");const _=o.getNode();l=e.serverCache.getNode();const g=cr(i,t,_,l);a=null!=g?n.filter.updatePriority(_,g):o.getNode()}else{const _=M(t);let g;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();const m=cr(i,t,o.getNode(),l);g=null!=m?o.getNode().getImmediateChild(c).updateChild(_,m):o.getNode().getImmediateChild(c)}else g=ji(i,c,e.serverCache);a=null!=g?n.filter.updateChild(o.getNode(),c,g,_,s,r):o.getNode()}}return sn(e,a,o.isFullyInitialized()||A(t),n.filter.filtersNodes())}}function qn(n,e,t,i,s,r,o,a){const l=e.serverCache;let c;const _=o?n.filter:n.filter.getIndexedFilter();if(A(t))c=_.updateFullNode(l.getNode(),i,null);else if(_.filtersNodes()&&!l.isFiltered()){const C=l.getNode().updateChild(t,i);c=_.updateFullNode(l.getNode(),C,null)}else{const C=R(t);if(!l.isCompleteForPath(t)&&ze(t)>1)return e;const w=M(t),V=l.getNode().getImmediateChild(C).updateChild(w,i);c=".priority"===C?_.updatePriority(l.getNode(),V):_.updateChild(l.getNode(),C,V,w,fr,null)}const g=sr(e,c,l.isFullyInitialized()||A(t),_.filtersNodes());return _r(n,g,t,s,new Yi(s,g,r),a)}function Zi(n,e,t,i,s,r,o){const a=e.eventCache;let l,c;const _=new Yi(s,e,r);if(A(t))c=n.filter.updateFullNode(e.eventCache.getNode(),i,o),l=sn(e,c,!0,n.filter.filtersNodes());else{const g=R(t);if(".priority"===g)c=n.filter.updatePriority(e.eventCache.getNode(),i),l=sn(e,c,a.isFullyInitialized(),a.isFiltered());else{const m=M(t),C=a.getNode().getImmediateChild(g);let w;if(A(m))w=i;else{const N=_.getCompleteChild(g);w=null!=N?".priority"===Ri(m)&&N.getChild(zs(m)).isEmpty()?N:N.updateChild(m,i):S.EMPTY_NODE}l=C.equals(w)?e:sn(e,n.filter.updateChild(a.getNode(),g,w,m,_,o),a.isFullyInitialized(),n.filter.filtersNodes())}}return l}function pr(n,e){return n.eventCache.isCompleteForChild(e)}function gr(n,e,t){return t.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function qi(n,e,t,i,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c,l=e;c=A(t)?i:new U(null).setTree(t,i);const _=e.serverCache.getNode();return c.children.inorderTraversal((g,m)=>{if(_.hasChild(g)){const w=gr(0,e.serverCache.getNode().getImmediateChild(g),m);l=qn(n,l,new O(g),w,s,r,o,a)}}),c.children.inorderTraversal((g,m)=>{const C=!e.serverCache.isCompleteForChild(g)&&null===m.value;if(!_.hasChild(g)&&!C){const N=gr(0,e.serverCache.getNode().getImmediateChild(g),m);l=qn(n,l,new O(g),N,s,r,o,a)}}),l}class nl{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const i=this.query_._queryParams,s=new Li(i.getIndex()),r=function ga(n){return n.loadsAllData()?new Li(n.getIndex()):n.hasLimit()?new pa(n):new en(n)}(i);this.processor_=function ja(n){return{filter:n}}(r);const o=t.serverCache,a=t.eventCache,l=s.updateFullNode(S.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(S.EMPTY_NODE,a.getNode(),null),_=new $e(l,o.isFullyInitialized(),s.filtersNodes()),g=new $e(c,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=Qn(g,_),this.eventGenerator_=new Ra(this.query_)}get query(){return this.query_}}function rl(n,e){const t=ct(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!A(e)&&!t.getImmediateChild(R(e)).isEmpty())?t.getChild(e):null}function mr(n){return 0===n.eventRegistrations_.length}function vr(n,e,t){const i=[];if(t){(0,u.hu)(null==e,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(r=>{const o=r.createCancelEvent(t,s);o&&i.push(o)})}if(e){let s=[];for(let r=0;r<n.eventRegistrations_.length;++r){const o=n.eventRegistrations_[r];if(o.matches(e)){if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(r+1));break}}else s.push(o)}n.eventRegistrations_=s}else n.eventRegistrations_=[];return i}function yr(n,e,t,i){e.type===fe.MERGE&&null!==e.source.queryId&&((0,u.hu)(ct(n.viewCache_),"We should always have a full cache before handling merges"),(0,u.hu)(Kn(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,r=function Za(n,e,t,i,s){const r=new Qa;let o,a;if(t.type===fe.OVERWRITE){const c=t;c.source.fromUser?o=Zi(n,e,c.path,c.snap,i,s,r):((0,u.hu)(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!A(c.path),o=qn(n,e,c.path,c.snap,i,s,a,r))}else if(t.type===fe.MERGE){const c=t;c.source.fromUser?o=function Xa(n,e,t,i,s,r,o){let a=e;return i.foreach((l,c)=>{const _=B(t,l);pr(e,R(_))&&(a=Zi(n,a,_,c,s,r,o))}),i.foreach((l,c)=>{const _=B(t,l);pr(e,R(_))||(a=Zi(n,a,_,c,s,r,o))}),a}(n,e,c.path,c.children,i,s,r):((0,u.hu)(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=qi(n,e,c.path,c.children,i,s,a,r))}else if(t.type===fe.ACK_USER_WRITE){const c=t;o=c.revert?function tl(n,e,t,i,s,r){let o;if(null!=Zn(i,t))return e;{const a=new Yi(i,e,s),l=e.eventCache.getNode();let c;if(A(t)||".priority"===R(t)){let _;if(e.serverCache.isFullyInitialized())_=Yn(i,ct(e));else{const g=e.serverCache.getNode();(0,u.hu)(g instanceof S,"serverChildren would be complete if leaf node"),_=Ki(i,g)}c=n.filter.updateFullNode(l,_,r)}else{const _=R(t);let g=ji(i,_,e.serverCache);null==g&&e.serverCache.isCompleteForChild(_)&&(g=l.getImmediateChild(_)),c=null!=g?n.filter.updateChild(l,_,g,M(t),a,r):e.eventCache.getNode().hasChild(_)?n.filter.updateChild(l,_,S.EMPTY_NODE,M(t),a,r):l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Yn(i,ct(e)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||null!=Zn(i,D()),sn(e,c,o,n.filter.filtersNodes())}}(n,e,c.path,i,s,r):function Ja(n,e,t,i,s,r,o){if(null!=Zn(s,t))return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(null!=i.value){if(A(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return qn(n,e,t,l.getNode().getChild(t),s,r,a,o);if(A(t)){let c=new U(null);return l.getNode().forEachChild(Ne,(_,g)=>{c=c.set(new O(_),g)}),qi(n,e,t,c,s,r,a,o)}return e}{let c=new U(null);return i.foreach((_,g)=>{const m=B(t,_);l.isCompleteForPath(m)&&(c=c.set(_,l.getNode().getChild(m)))}),qi(n,e,t,c,s,r,a,o)}}(n,e,c.path,c.affectedTree,i,s,r)}else{if(t.type!==fe.LISTEN_COMPLETE)throw(0,u.g5)("Unknown operation type: "+t.type);o=function el(n,e,t,i,s){const r=e.serverCache;return _r(n,sr(e,r.getNode(),r.isFullyInitialized()||A(t),r.isFiltered()),t,i,fr,s)}(n,e,t.path,i,r)}const l=r.getChanges();return function qa(n,e,t){const i=e.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=Kn(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&t.push(er(Kn(e)))}}(e,o,l),{viewCache:o,changes:l}}(n.processor_,s,e,t,i);return function Ya(n,e){(0,u.hu)(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),(0,u.hu)(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}(n.processor_,r.viewCache),(0,u.hu)(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,Cr(n,r.changes,r.viewCache.eventCache.getNode(),null)}function Cr(n,e,t,i){return function Aa(n,e,t,i){const s=[],r=[];return e.forEach(o=>{"child_changed"===o.type&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(function _a(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}(o.childName,o.snapshotNode))}),nn(n,s,"child_removed",e,i,t),nn(n,s,"child_added",e,i,t),nn(n,s,"child_moved",r,i,t),nn(n,s,"child_changed",e,i,t),nn(n,s,"value",e,i,t),s}(n.eventGenerator_,e,t,i?[i]:n.eventRegistrations_)}let Xn,ei;class Er{constructor(){this.views=new Map}}function Xi(n,e,t,i){const s=e.source.queryId;if(null!==s){const r=n.views.get(s);return(0,u.hu)(null!=r,"SyncTree gave us an op for an invalid query."),yr(r,e,t,i)}{let r=[];for(const o of n.views.values())r=r.concat(yr(o,e,t,i));return r}}function wr(n,e,t,i,s){const o=n.views.get(e._queryIdentifier);if(!o){let a=Yn(t,s?i:null),l=!1;a?l=!0:i instanceof S?(a=Ki(t,i),l=!1):(a=S.EMPTY_NODE,l=!1);const c=Qn(new $e(a,l,!1),new $e(i,s,!1));return new nl(e,c)}return o}function Ir(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Ke(n,e){let t=null;for(const i of n.views.values())t=t||rl(i,e);return t}function Tr(n,e){return e._queryParams.loadsAllData()?Jn(n):n.views.get(e._queryIdentifier)}function Sr(n,e){return null!=Tr(n,e)}function je(n){return null!=Jn(n)}function Jn(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let pl=1;class br{constructor(e){this.listenProvider_=e,this.syncPointTree_=new U(null),this.pendingWriteTree_=function za(){return{visibleWrites:Ie.empty(),allWrites:[],lastWriteId:-1}}(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Ji(n,e,t,i,s){return function xa(n,e,t,i,s){(0,u.hu)(i>n.lastWriteId,"Stacking an older write on top of newer ones"),void 0===s&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:s}),s&&(n.visibleWrites=rn(n.visibleWrites,e,t)),n.lastWriteId=i}(n.pendingWriteTree_,e,t,i,s),s?Pt(n,new ut({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,t)):[]}function Ye(n,e,t=!1){const i=function Oa(n,e){for(let t=0;t<n.allWrites.length;t++){const i=n.allWrites[t];if(i.writeId===e)return i}return null}(n.pendingWriteTree_,e);if(function La(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);(0,u.hu)(t>=0,"removeWrite called with nonexistent writeId.");const i=n.allWrites[t];n.allWrites.splice(t,1);let s=i.visible,r=!1,o=n.allWrites.length-1;for(;s&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&Ma(a,i.path)?s=!1:de(i.path,a.path)&&(r=!0)),o--}return!!s&&(r?(function Fa(n){n.visibleWrites=lr(n.allWrites,Wa,D()),n.lastWriteId=n.allWrites.length>0?n.allWrites[n.allWrites.length-1].writeId:-1}(n),!0):(i.snap?n.visibleWrites=rr(n.visibleWrites,i.path):$(i.children,l=>{n.visibleWrites=rr(n.visibleWrites,B(i.path,l))}),!0))}(n.pendingWriteTree_,e)){let r=new U(null);return null!=i.snap?r=r.set(D(),!0):$(i.children,o=>{r=r.set(new O(o),!0)}),Pt(n,new $n(i.path,r,t))}return[]}function on(n,e,t){return Pt(n,new ut({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,t))}function ti(n,e,t,i,s=!1){const r=e._path,o=n.syncPointTree_.get(r);let a=[];if(o&&("default"===e._queryIdentifier||Sr(o,e))){const l=function dl(n,e,t,i){const s=e._queryIdentifier,r=[];let o=[];const a=je(n);if("default"===s)for(const[l,c]of n.views.entries())o=o.concat(vr(c,t,i)),mr(c)&&(n.views.delete(l),c.query._queryParams.loadsAllData()||r.push(c.query));else{const l=n.views.get(s);l&&(o=o.concat(vr(l,t,i)),mr(l)&&(n.views.delete(s),l.query._queryParams.loadsAllData()||r.push(l.query)))}return a&&!je(n)&&r.push(new(function ul(){return(0,u.hu)(Xn,"Reference.ts has not been loaded"),Xn}())(e._repo,e._path)),{removed:r,events:o}}(o,e,t,i);(function cl(n){return 0===n.views.size})(o)&&(n.syncPointTree_=n.syncPointTree_.remove(r));const c=l.removed;if(a=l.events,!s){const _=-1!==c.findIndex(m=>m._queryParams.loadsAllData()),g=n.syncPointTree_.findOnPath(r,(m,C)=>je(C));if(_&&!g){const m=n.syncPointTree_.subtree(r);if(!m.isEmpty()){const C=function wl(n){return n.fold((e,t,i)=>{if(t&&je(t))return[Jn(t)];{let s=[];return t&&(s=Ir(t)),$(i,(r,o)=>{s=s.concat(o)}),s}})}(m);for(let w=0;w<C.length;++w){const N=C[w],V=N.query,te=Pr(n,N);n.listenProvider_.startListening(ln(V),an(n,V),te.hashFn,te.onComplete)}}}!g&&c.length>0&&!i&&(_?n.listenProvider_.stopListening(ln(e),null):c.forEach(m=>{const C=n.queryToTagMap.get(ii(m));n.listenProvider_.stopListening(ln(m),C)}))}!function Il(n,e){for(let t=0;t<e.length;++t){const i=e[t];if(!i._queryParams.loadsAllData()){const s=ii(i),r=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(r)}}}(n,c)}return a}function Rr(n,e,t,i){const s=ts(n,i);if(null!=s){const r=ns(s),o=r.path,a=r.queryId,l=ee(o,e);return is(n,o,new ut(Gi(a),l,t))}return[]}function es(n,e,t,i=!1){const s=e._path;let r=null,o=!1;n.syncPointTree_.foreachOnPath(s,(m,C)=>{const w=ee(m,s);r=r||Ke(C,w),o=o||je(C)});let l,a=n.syncPointTree_.get(s);a?(o=o||je(a),r=r||Ke(a,D())):(a=new Er,n.syncPointTree_=n.syncPointTree_.set(s,a)),null!=r?l=!0:(l=!1,r=S.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((C,w)=>{const N=Ke(w,D());N&&(r=r.updateImmediateChild(C,N))}));const c=Sr(a,e);if(!c&&!e._queryParams.loadsAllData()){const m=ii(e);(0,u.hu)(!n.queryToTagMap.has(m),"View does not exist, but we have a tag");const C=function Tl(){return pl++}();n.queryToTagMap.set(m,C),n.tagToQueryMap.set(C,m)}let g=function hl(n,e,t,i,s,r){const o=wr(n,e,i,s,r);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),function ol(n,e){n.eventRegistrations_.push(e)}(o,t),function al(n,e){const t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(W,(r,o)=>{i.push(bt(r,o))}),t.isFullyInitialized()&&i.push(er(t.getNode())),Cr(n,i,t.getNode(),e)}(o,t)}(a,e,t,jn(n.pendingWriteTree_,s),r,l);if(!c&&!o&&!i){const m=Tr(a,e);g=g.concat(function Sl(n,e,t){const i=e._path,s=an(n,e),r=Pr(n,t),o=n.listenProvider_.startListening(ln(e),s,r.hashFn,r.onComplete),a=n.syncPointTree_.subtree(i);if(s)(0,u.hu)(!je(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((c,_,g)=>{if(!A(c)&&_&&je(_))return[Jn(_).query];{let m=[];return _&&(m=m.concat(Ir(_).map(C=>C.query))),$(g,(C,w)=>{m=m.concat(w)}),m}});for(let c=0;c<l.length;++c){const _=l[c];n.listenProvider_.stopListening(ln(_),an(n,_))}}return o}(n,e,m))}return g}function ni(n,e,t){const s=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,a)=>{const c=Ke(a,ee(o,e));if(c)return c});return ur(s,e,r,t,!0)}function Pt(n,e){return Ar(e,n.syncPointTree_,null,jn(n.pendingWriteTree_,D()))}function Ar(n,e,t,i){if(A(n.path))return Nr(n,e,t,i);{const s=e.get(D());null==t&&null!=s&&(t=Ke(s,D()));let r=[];const o=R(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){const c=t?t.getImmediateChild(o):null,_=hr(i,o);r=r.concat(Ar(a,l,c,_))}return s&&(r=r.concat(Xi(s,n,i,t))),r}}function Nr(n,e,t,i){const s=e.get(D());null==t&&null!=s&&(t=Ke(s,D()));let r=[];return e.children.inorderTraversal((o,a)=>{const l=t?t.getImmediateChild(o):null,c=hr(i,o),_=n.operationForChild(o);_&&(r=r.concat(Nr(_,a,l,c)))}),s&&(r=r.concat(Xi(s,n,i,t))),r}function Pr(n,e){const t=e.query,i=an(n,t);return{hashFn:()=>(function il(n){return n.viewCache_.serverCache.getNode()}(e)||S.EMPTY_NODE).hash(),onComplete:s=>{if("ok"===s)return i?function yl(n,e,t){const i=ts(n,t);if(i){const s=ns(i),r=s.path,o=s.queryId,a=ee(r,e);return is(n,r,new tn(Gi(o),a))}return[]}(n,t._path,i):function vl(n,e){return Pt(n,new tn({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e))}(n,t._path);{const r=function Bt(n,e){let t="Unknown Error";"too_big"===n?t="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===n?t="Client doesn't have permission to access the desired data.":"unavailable"===n&&(t="The service is unavailable");const i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}(s,t);return ti(n,t,null,r)}}}}function an(n,e){const t=ii(e);return n.queryToTagMap.get(t)}function ii(n){return n._path.toString()+"$"+n._queryIdentifier}function ts(n,e){return n.tagToQueryMap.get(e)}function ns(n){const e=n.indexOf("$");return(0,u.hu)(-1!==e&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new O(n.substr(0,e))}}function is(n,e,t){const i=n.syncPointTree_.get(e);return(0,u.hu)(i,"Missing sync point for query tag that we're tracking"),Xi(i,t,jn(n.pendingWriteTree_,e),null)}function ln(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(function _l(){return(0,u.hu)(ei,"Reference.ts has not been loaded"),ei}())(n._repo,n._path):n}class ss{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new ss(t)}node(){return this.node_}}class rs{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=B(this.path_,e);return new rs(this.syncTree_,t)}node(){return ni(this.syncTree_,this.path_)}}const kr=function(n,e,t){return n&&"object"==typeof n?((0,u.hu)(".sv"in n,"Unexpected leaf node or priority contents"),"string"==typeof n[".sv"]?Rl(n[".sv"],e,t):"object"==typeof n[".sv"]?Al(n[".sv"],e):void(0,u.hu)(!1,"Unexpected server value: "+JSON.stringify(n,null,2))):n},Rl=function(n,e,t){if("timestamp"===n)return t.timestamp;(0,u.hu)(!1,"Unexpected server value: "+n)},Al=function(n,e,t){n.hasOwnProperty("increment")||(0,u.hu)(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const i=n.increment;"number"!=typeof i&&(0,u.hu)(!1,"Unexpected increment value: "+i);const s=e.node();if((0,u.hu)(null!==s&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const o=s.getValue();return"number"!=typeof o?i:o+i},xr=function(n,e,t,i){return as(e,new rs(t,n),i)},os=function(n,e,t){return as(n,new ss(e),t)};function as(n,e,t){const i=n.getPriority().val(),s=kr(i,e.getImmediateChild(".priority"),t);let r;if(n.isLeafNode()){const o=n,a=kr(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new Tt(a,H(s)):n}{const o=n;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new Tt(s))),o.forEachChild(W,(a,l)=>{const c=as(l,e.getImmediateChild(a),t);c!==l&&(r=r.updateImmediateChild(a,c))}),r}}class ls{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}}function si(n,e){let t=e instanceof O?e:new O(e),i=n,s=R(t);for(;null!==s;){const r=(0,u.DV)(i.node.children,s)||{children:{},childCount:0};i=new ls(s,i,r),t=M(t),s=R(t)}return i}function dt(n){return n.node.value}function us(n,e){n.node.value=e,cs(n)}function Dr(n){return n.node.childCount>0}function ri(n,e){$(n.node.children,(t,i)=>{e(new ls(t,n,i))})}function Or(n,e,t,i){t&&!i&&e(n),ri(n,s=>{Or(s,e,!0,i)}),t&&i&&e(n)}function un(n){return new O(null===n.parent?n.name:un(n.parent)+"/"+n.name)}function cs(n){null!==n.parent&&function kl(n,e,t){const i=function Nl(n){return void 0===dt(n)&&!Dr(n)}(t),s=(0,u.r3)(n.node.children,e);i&&s?(delete n.node.children[e],n.node.childCount--,cs(n)):!i&&!s&&(n.node.children[e]=t.node,n.node.childCount++,cs(n))}(n.parent,n.name,n)}const xl=/[\[\].#$\/\u0000-\u001F\u007F]/,Dl=/[\[\].#$\u0000-\u001F\u007F]/,hs=10485760,oi=function(n){return"string"==typeof n&&0!==n.length&&!xl.test(n)},Lr=function(n){return"string"==typeof n&&0!==n.length&&!Dl.test(n)},cn=function(n){return null===n||"string"==typeof n||"number"==typeof n&&!it(n)||n&&"object"==typeof n&&(0,u.r3)(n,".sv")},Pe=function(n,e,t,i){i&&void 0===e||hn((0,u.gK)(n,"value"),e,t)},hn=function(n,e,t){const i=t instanceof O?new Zo(t,n):t;if(void 0===e)throw new Error(n+"contains undefined "+at(i));if("function"==typeof e)throw new Error(n+"contains a function "+at(i)+" with contents = "+e.toString());if(it(e))throw new Error(n+"contains "+e.toString()+" "+at(i));if("string"==typeof e&&e.length>hs/3&&(0,u.ug)(e)>hs)throw new Error(n+"contains a string greater than "+hs+" utf8 bytes "+at(i)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let s=!1,r=!1;if($(e,(o,a)=>{if(".value"===o)s=!0;else if(".priority"!==o&&".sv"!==o&&(r=!0,!oi(o)))throw new Error(n+" contains an invalid key ("+o+") "+at(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');(function qo(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=(0,u.ug)(e),$s(n)})(i,o),hn(n,a,i),function Xo(n){const e=n.parts_.pop();n.byteLength_-=(0,u.ug)(e),n.parts_.length>0&&(n.byteLength_-=1)}(i)}),s&&r)throw new Error(n+' contains ".value" child '+at(i)+" in addition to actual children.")}},Mr=function(n,e,t,i){if(i&&void 0===e)return;const s=(0,u.gK)(n,"values");if(!e||"object"!=typeof e||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const r=[];$(e,(o,a)=>{const l=new O(o);if(hn(s,a,B(t,l)),".priority"===Ri(l)&&!cn(a))throw new Error(s+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(l)}),function(n,e){let t,i;for(t=0;t<e.length;t++){i=e[t];const r=jt(i);for(let o=0;o<r.length;o++)if((".priority"!==r[o]||o!==r.length-1)&&!oi(r[o]))throw new Error(n+"contains an invalid key ("+r[o]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}e.sort(Yo);let s=null;for(t=0;t<e.length;t++){if(i=e[t],null!==s&&de(s,i))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+i.toString());s=i}}(s,r)},ds=function(n,e,t){if(!t||void 0!==e){if(it(e))throw new Error((0,u.gK)(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!cn(e))throw new Error((0,u.gK)(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},dn=function(n,e,t,i){if(!(i&&void 0===t||oi(t)))throw new Error((0,u.gK)(n,e)+'was an invalid key = "'+t+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},fn=function(n,e,t,i){if(!(i&&void 0===t||Lr(t)))throw new Error((0,u.gK)(n,e)+'was an invalid path = "'+t+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},_e=function(n,e){if(".info"===R(e))throw new Error(n+" failed = Can't modify data under /.info/")},Fr=function(n,e){const t=e.path.toString();if("string"!=typeof e.repoInfo.host||0===e.repoInfo.host.length||!oi(e.repoInfo.namespace)&&"localhost"!==e.repoInfo.host.split(":")[0]||0!==t.length&&!function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Lr(n)}(t))throw new Error((0,u.gK)(n,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class Fl{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function ai(n,e){let t=null;for(let i=0;i<e.length;i++){const s=e[i],r=s.getPath();null!==t&&!Ai(r,t.path)&&(n.eventLists_.push(t),t=null),null===t&&(t={events:[],path:r}),t.events.push(s)}t&&n.eventLists_.push(t)}function Wr(n,e,t){ai(n,t),Ur(n,i=>Ai(i,e))}function oe(n,e,t){ai(n,t),Ur(n,i=>de(i,e)||de(e,i))}function Ur(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){const s=n.eventLists_[i];s&&(e(s.path)?(Wl(n.eventLists_[i]),n.eventLists_[i]=null):t=!1)}t&&(n.eventLists_=[]),n.recursionDepth_--}function Wl(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(null!==t){n.events[e]=null;const i=t.getEventRunner();Oe&&z("event: "+t.toString()),Ge(i)}}}const Br="repo_interrupt";class Bl{constructor(e,t,i,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Fl,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=zn(),this.transactionQueueTree_=new ls,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Vr(n){const t=n.infoData_.getNode(new O(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function _n(n){return function(n){return(n=n||{}).timestamp=n.timestamp||(new Date).getTime(),n}({timestamp:Vr(n)})}function Gr(n,e,t,i,s){n.dataUpdateCount++;const r=new O(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(i){const l=(0,u.UI)(t,c=>H(c));o=function Cl(n,e,t,i){const s=ts(n,i);if(s){const r=ns(s),o=r.path,a=r.queryId,l=ee(o,e),c=U.fromObject(t);return is(n,o,new At(Gi(a),l,c))}return[]}(n.serverSyncTree_,r,l,s)}else{const l=H(t);o=Rr(n.serverSyncTree_,r,l,s)}else if(i){const l=(0,u.UI)(t,c=>H(c));o=function ml(n,e,t){const i=U.fromObject(t);return Pt(n,new At({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,i))}(n.serverSyncTree_,r,l)}else{const l=H(t);o=on(n.serverSyncTree_,r,l)}let a=r;o.length>0&&(a=xt(n,r)),oe(n.eventQueue_,a,o)}function Hr(n,e){fs(n,"connected",e),!1===e&&function $l(n){kt(n,"onDisconnectEvents");const e=_n(n),t=zn();Ui(n.onDisconnect_,D(),(s,r)=>{const o=xr(s,r,n.serverSyncTree_,e);Rt(t,s,o)});let i=[];Ui(t,D(),(s,r)=>{i=i.concat(on(n.serverSyncTree_,s,r));const o=ms(n,s);xt(n,o)}),n.onDisconnect_=zn(),oe(n.eventQueue_,D(),i)}(n)}function fs(n,e,t){const i=new O("/.info/"+e),s=H(t);n.infoData_.updateSnapshot(i,s);const r=on(n.infoSyncTree_,i,s);oe(n.eventQueue_,i,r)}function li(n){return n.nextWriteId_++}function _s(n,e,t,i,s){kt(n,"set",{path:e.toString(),value:t,priority:i});const r=_n(n),o=H(t,i),a=ni(n.serverSyncTree_,e),l=os(o,a,r),c=li(n),_=Ji(n.serverSyncTree_,e,l,c,!0);ai(n.eventQueue_,_),n.server_.put(e.toString(),o.val(!0),(m,C)=>{const w="ok"===m;w||j("set at "+e+" failed: "+m);const N=Ye(n.serverSyncTree_,c,!w);oe(n.eventQueue_,e,N),Ze(0,s,m,C)});const g=ms(n,e);xt(n,g),oe(n.eventQueue_,g,[])}function Ql(n,e,t){n.server_.onDisconnectCancel(e.toString(),(i,s)=>{"ok"===i&&Wi(n.onDisconnect_,e),Ze(0,t,i,s)})}function zr(n,e,t,i){const s=H(t);n.server_.onDisconnectPut(e.toString(),s.val(!0),(r,o)=>{"ok"===r&&Rt(n.onDisconnect_,e,s),Ze(0,i,r,o)})}function ps(n,e,t){let i;i=".info"===R(e._path)?ti(n.infoSyncTree_,e,t):ti(n.serverSyncTree_,e,t),Wr(n.eventQueue_,e._path,i)}function $r(n){n.persistentConnection_&&n.persistentConnection_.interrupt(Br)}function kt(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),z(t,...e)}function Ze(n,e,t,i){e&&Ge(()=>{if("ok"===t)e(null);else{const s=(t||"error").toUpperCase();let r=s;i&&(r+=": "+i);const o=new Error(r);o.code=s,e(o)}})}function gs(n,e,t){return ni(n.serverSyncTree_,e,t)||S.EMPTY_NODE}function ui(n,e=n.transactionQueueTree_){if(e||ci(n,e),dt(e)){const t=Kr(n,e);(0,u.hu)(t.length>0,"Sending zero length transaction queue"),t.every(s=>0===s.status)&&function Xl(n,e,t){const i=t.map(c=>c.currentWriteId),s=gs(n,e,i);let r=s;const o=s.hash();for(let c=0;c<t.length;c++){const _=t[c];(0,u.hu)(0===_.status,"tryToSendTransactionQueue_: items in queue should all be run."),_.status=1,_.retryCount++;const g=ee(e,_.path);r=r.updateChild(g,_.currentOutputSnapshotRaw)}const a=r.val(!0),l=e;n.server_.put(l.toString(),a,c=>{kt(n,"transaction put response",{path:l.toString(),status:c});let _=[];if("ok"===c){const g=[];for(let m=0;m<t.length;m++)t[m].status=2,_=_.concat(Ye(n.serverSyncTree_,t[m].currentWriteId)),t[m].onComplete&&g.push(()=>t[m].onComplete(null,!0,t[m].currentOutputSnapshotResolved)),t[m].unwatcher();ci(n,si(n.transactionQueueTree_,e)),ui(n,n.transactionQueueTree_),oe(n.eventQueue_,e,_);for(let m=0;m<g.length;m++)Ge(g[m])}else{if("datastale"===c)for(let g=0;g<t.length;g++)t[g].status=3===t[g].status?4:0;else{j("transaction at "+l.toString()+" failed: "+c);for(let g=0;g<t.length;g++)t[g].status=4,t[g].abortReason=c}xt(n,e)}},o)}(n,un(e),t)}else Dr(e)&&ri(e,t=>{ui(n,t)})}function xt(n,e){const t=Qr(n,e),i=un(t);return function Jl(n,e,t){if(0===e.length)return;const i=[];let s=[];const o=e.filter(a=>0===a.status).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],c=ee(t,l.path);let g,_=!1;if((0,u.hu)(null!==c,"rerunTransactionsUnderNode_: relativePath should not be null."),4===l.status)_=!0,g=l.abortReason,s=s.concat(Ye(n.serverSyncTree_,l.currentWriteId,!0));else if(0===l.status)if(l.retryCount>=25)_=!0,g="maxretry",s=s.concat(Ye(n.serverSyncTree_,l.currentWriteId,!0));else{const m=gs(n,l.path,o);l.currentInputSnapshot=m;const C=e[a].update(m.val());if(void 0!==C){hn("transaction failed: Data returned ",C,l.path);let w=H(C);"object"==typeof C&&null!=C&&(0,u.r3)(C,".priority")||(w=w.updatePriority(m.getPriority()));const V=l.currentWriteId,te=_n(n),le=os(w,m,te);l.currentOutputSnapshotRaw=w,l.currentOutputSnapshotResolved=le,l.currentWriteId=li(n),o.splice(o.indexOf(V),1),s=s.concat(Ji(n.serverSyncTree_,l.path,le,l.currentWriteId,l.applyLocally)),s=s.concat(Ye(n.serverSyncTree_,V,!0))}else _=!0,g="nodata",s=s.concat(Ye(n.serverSyncTree_,l.currentWriteId,!0))}oe(n.eventQueue_,t,s),s=[],_&&(e[a].status=2,setTimeout(e[a].unwatcher,Math.floor(0)),e[a].onComplete&&i.push("nodata"===g?()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot):()=>e[a].onComplete(new Error(g),!1,null)))}ci(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)Ge(i[a]);ui(n,n.transactionQueueTree_)}(n,Kr(n,t),i),i}function Qr(n,e){let t,i=n.transactionQueueTree_;for(t=R(e);null!==t&&void 0===dt(i);)i=si(i,t),t=R(e=M(e));return i}function Kr(n,e){const t=[];return jr(n,e,t),t.sort((i,s)=>i.order-s.order),t}function jr(n,e,t){const i=dt(e);if(i)for(let s=0;s<i.length;s++)t.push(i[s]);ri(e,s=>{jr(n,s,t)})}function ci(n,e){const t=dt(e);if(t){let i=0;for(let s=0;s<t.length;s++)2!==t[s].status&&(t[i]=t[s],i++);t.length=i,us(e,t.length>0?t:void 0)}ri(e,i=>{ci(n,i)})}function ms(n,e){const t=un(Qr(n,e)),i=si(n.transactionQueueTree_,e);return function Pl(n,e,t){let i=t?n:n.parent;for(;null!==i;){if(e(i))return!0;i=i.parent}}(i,s=>{vs(n,s)}),vs(n,i),Or(i,s=>{vs(n,s)}),t}function vs(n,e){const t=dt(e);if(t){const i=[];let s=[],r=-1;for(let o=0;o<t.length;o++)3===t[o].status||(1===t[o].status?((0,u.hu)(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):((0,u.hu)(0===t[o].status,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(Ye(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));-1===r?us(e,void 0):t.length=r+1,oe(n.eventQueue_,un(e),s);for(let o=0;o<i.length;o++)Ge(i[o])}}const ys=function(n,e){const t=nu(n),i=t.namespace;return"firebase.com"===t.domain&&ce(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||"undefined"===i)&&"localhost"!==t.domain&&ce("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||typeof window<"u"&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&j("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new ot(t.host,t.secure,i,"ws"===t.scheme||"wss"===t.scheme,e,"",i!==t.subdomain),path:new O(t.pathString)}},nu=function(n){let e="",t="",i="",s="",r="",o=!0,a="https",l=443;if("string"==typeof n){let c=n.indexOf("//");c>=0&&(a=n.substring(0,c-1),n=n.substring(c+2));let _=n.indexOf("/");-1===_&&(_=n.length);let g=n.indexOf("?");-1===g&&(g=n.length),e=n.substring(0,Math.min(_,g)),_<g&&(s=function eu(n){let e="";const t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let s=t[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}(n.substring(_,g)));const m=function tu(n){const e={};"?"===n.charAt(0)&&(n=n.substring(1));for(const t of n.split("&")){if(0===t.length)continue;const i=t.split("=");2===i.length?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):j(`Invalid query segment '${t}' in query '${n}'`)}return e}(n.substring(Math.min(n.length,g)));c=e.indexOf(":"),c>=0?(o="https"===a||"wss"===a,l=parseInt(e.substring(c+1),10)):c=e.length;const C=e.slice(0,c);if("localhost"===C.toLowerCase())t="localhost";else if(C.split(".").length<=2)t=C;else{const w=e.indexOf(".");i=e.substring(0,w).toLowerCase(),t=e.substring(w+1),r=i}"ns"in m&&(r=m.ns)}return{host:e,port:l,domain:t,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}},Yr="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",iu=function(){let n=0;const e=[];return function(t){const i=t===n;let s;n=t;const r=new Array(8);for(s=7;s>=0;s--)r[s]=Yr.charAt(t%64),t=Math.floor(t/64);(0,u.hu)(0===t,"Cannot push at time == 0");let o=r.join("");if(i){for(s=11;s>=0&&63===e[s];s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(64*Math.random());for(s=0;s<12;s++)o+=Yr.charAt(e[s]);return(0,u.hu)(20===o.length,"nextPushId: Length should be 20."),o}}();class Zr{constructor(e,t,i,s){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=s}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+(0,u.Wl)(this.snapshot.exportVal())}}class qr{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Cs{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return(0,u.hu)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Xr{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new u.BH;return Ql(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){_e("OnDisconnect.remove",this._path);const e=new u.BH;return zr(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){_e("OnDisconnect.set",this._path),Pe("OnDisconnect.set",e,this._path,!1);const t=new u.BH;return zr(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){_e("OnDisconnect.setWithPriority",this._path),Pe("OnDisconnect.setWithPriority",e,this._path,!1),ds("OnDisconnect.setWithPriority",t,!1);const i=new u.BH;return function Kl(n,e,t,i,s){const r=H(t,i);n.server_.onDisconnectPut(e.toString(),r.val(!0),(o,a)=>{"ok"===o&&Rt(n.onDisconnect_,e,r),Ze(0,s,o,a)})}(this._repo,this._path,e,t,i.wrapCallback(()=>{})),i.promise}update(e){_e("OnDisconnect.update",this._path),Mr("OnDisconnect.update",e,this._path,!1);const t=new u.BH;return function jl(n,e,t,i){if((0,u.xb)(t))return z("onDisconnect().update() called with empty data.  Don't do anything."),void Ze(0,i,"ok",void 0);n.server_.onDisconnectMerge(e.toString(),t,(s,r)=>{"ok"===s&&$(t,(o,a)=>{const l=H(a);Rt(n.onDisconnect_,B(e,o),l)}),Ze(0,i,s,r)})}(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class re{constructor(e,t,i,s){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=s}get key(){return A(this._path)?null:Ri(this._path)}get ref(){return new pe(this._repo,this._path)}get _queryIdentifier(){const e=nr(this._queryParams),t=yt(e);return"{}"===t?"default":t}get _queryObject(){return nr(this._queryParams)}isEqual(e){if(!((e=(0,u.m9)(e))instanceof re))return!1;const t=this._repo===e._repo,i=Ai(this._path,e._path);return t&&i&&this._queryIdentifier===e._queryIdentifier}toJSON(){return this.toString()}toString(){return this._repo.toString()+function jo(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)""!==n.pieces_[t]&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}(this._path)}}function hi(n,e){if(!0===n._orderByCalled)throw new Error(e+": You can't combine multiple orderBy calls.")}function qe(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===Ne){const i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Re)throw new Error(i);if("string"!=typeof e)throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==me)throw new Error(i);if("string"!=typeof t)throw new Error(s)}}else if(n.getIndex()===W){if(null!=e&&!cn(e)||null!=t&&!cn(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if((0,u.hu)(n.getIndex()instanceof Di||n.getIndex()===Oi,"unknown index type."),null!=e&&"object"==typeof e||null!=t&&"object"==typeof t)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function di(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class pe extends re{constructor(e,t){super(e,t,new Vn,!1)}get parent(){const e=zs(this._path);return null===e?null:new pe(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class ft{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new O(e),i=Xe(this.ref,e);return new ft(this._node.getChild(t),i,W)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(i,s)=>e(new ft(s,Xe(this.ref,i),W)))}hasChild(e){const t=new O(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Es(n,e){return(n=(0,u.m9)(n))._checkNotDeleted("ref"),void 0!==e?Xe(n._root,e):n._root}function Jr(n,e){(n=(0,u.m9)(n))._checkNotDeleted("refFromURL");const t=ys(e,n._repo.repoInfo_.nodeAdmin);Fr("refFromURL",t);const i=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&i.host!==n._repo.repoInfo_.host&&ce("refFromURL: Host name does not match the current database: (found "+i.host+" but expected "+n._repo.repoInfo_.host+")"),Es(n,t.path.toString())}function Xe(n,e){return null===R((n=(0,u.m9)(n))._path)?(t=e,t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),fn("child","path",t,!1)):fn("child","path",e,!1),new pe(n._repo,B(n._path,e));var t}function eo(n,e){n=(0,u.m9)(n),_e("push",n._path),Pe("push",e,n._path,!0);const t=Vr(n._repo),i=iu(t),s=Xe(n,i),r=Xe(n,i);let o;return o=null!=e?ws(r,e).then(()=>r):Promise.resolve(r),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function ws(n,e){n=(0,u.m9)(n),_e("set",n._path),Pe("set",e,n._path,!1);const t=new u.BH;return _s(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function au(n,e){Mr("update",e,n._path,!1);const t=new u.BH;return function zl(n,e,t,i){kt(n,"update",{path:e.toString(),value:t});let s=!0;const r=_n(n),o={};if($(t,(a,l)=>{s=!1,o[a]=xr(B(e,a),H(l),n.serverSyncTree_,r)}),s)z("update() called with empty data.  Don't do anything."),Ze(0,i,"ok",void 0);else{const a=li(n),l=function gl(n,e,t,i){!function Da(n,e,t,i){(0,u.hu)(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:i,visible:!0}),n.visibleWrites=zi(n.visibleWrites,e,t),n.lastWriteId=i}(n.pendingWriteTree_,e,t,i);const s=U.fromObject(t);return Pt(n,new At({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,s))}(n.serverSyncTree_,e,o,a);ai(n.eventQueue_,l),n.server_.merge(e.toString(),t,(c,_)=>{const g="ok"===c;g||j("update at "+e+" failed: "+c);const m=Ye(n.serverSyncTree_,a,!g),C=m.length>0?xt(n,e):e;oe(n.eventQueue_,C,m),Ze(0,i,c,_)}),$(t,c=>{const _=ms(n,B(e,c));xt(n,_)}),oe(n.eventQueue_,e,[])}}(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function lu(n){n=(0,u.m9)(n);const e=new Cs(()=>{}),t=new pn(e);return function Hl(n,e,t){const i=function El(n,e){const t=e._path;let i=null;n.syncPointTree_.foreachOnPath(t,(c,_)=>{const g=ee(c,t);i=i||Ke(_,g)});let s=n.syncPointTree_.get(t);s?i=i||Ke(s,D()):(s=new Er,n.syncPointTree_=n.syncPointTree_.set(t,s));const r=null!=i,o=r?new $e(i,!0,!1):null;return function sl(n){return Kn(n.viewCache_)}(wr(s,e,jn(n.pendingWriteTree_,e._path),r?o.getNode():S.EMPTY_NODE,r))}(n.serverSyncTree_,e);return null!=i?Promise.resolve(i):n.server_.get(e).then(s=>{const r=H(s).withIndex(e._queryParams.getIndex());let o;if(es(n.serverSyncTree_,e,t,!0),e._queryParams.loadsAllData())o=on(n.serverSyncTree_,e._path,r);else{const a=an(n.serverSyncTree_,e);o=Rr(n.serverSyncTree_,e._path,r,a)}return oe(n.eventQueue_,e._path,o),ti(n.serverSyncTree_,e,t,null,!0),r},s=>(kt(n,"get for query "+(0,u.Wl)(e)+" failed: "+s),Promise.reject(new Error(s))))}(n._repo,n,t).then(i=>new ft(i,new pe(n._repo,n._path),n._queryParams.getIndex()))}class pn{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const i=t._queryParams.getIndex();return new Zr("value",this,new ft(e.snapshotNode,new pe(t._repo,t._path),i))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new qr(this,e,t):null}matches(e){return e instanceof pn&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class fi{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new qr(this,e,t):null}createEvent(e,t){(0,u.hu)(null!=e.childName,"Child events should have a childName.");const i=Xe(new pe(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new Zr(e.type,this,new ft(e.snapshotNode,i,s),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof fi&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function gn(n,e,t,i,s){let r;if("object"==typeof i&&(r=void 0,s=i),"function"==typeof i&&(r=i),s&&s.onlyOnce){const l=t,c=(_,g)=>{ps(n._repo,n,a),l(_,g)};c.userCallback=t.userCallback,c.context=t.context,t=c}const o=new Cs(t,r||void 0),a="value"===e?new pn(o):new fi(e,o);return function Yl(n,e,t){let i;i=".info"===R(e._path)?es(n.infoSyncTree_,e,t):es(n.serverSyncTree_,e,t),Wr(n.eventQueue_,e._path,i)}(n._repo,n,a),()=>ps(n._repo,n,a)}function Is(n,e,t,i){return gn(n,"value",e,t,i)}function to(n,e,t,i){return gn(n,"child_added",e,t,i)}function no(n,e,t,i){return gn(n,"child_changed",e,t,i)}function io(n,e,t,i){return gn(n,"child_moved",e,t,i)}function so(n,e,t,i){return gn(n,"child_removed",e,t,i)}function ro(n,e,t){let i=null;const s=t?new Cs(t):null;"value"===e?i=new pn(s):e&&(i=new fi(e,s)),ps(n._repo,n,i)}class Te{}class oo extends Te{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Pe("endAt",this._value,e._path,!0);const t=Fi(e._queryParams,this._value,this._key);if(di(t),qe(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new re(e._repo,e._path,t,e._orderByCalled)}}class cu extends Te{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Pe("endBefore",this._value,e._path,!1);const t=function Ca(n,e,t){let i;return i=Fi(n,e,n.index_===Ne||t?t:Re),i.endBeforeSet_=!0,i}(e._queryParams,this._value,this._key);if(di(t),qe(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new re(e._repo,e._path,t,e._orderByCalled)}}class ao extends Te{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Pe("startAt",this._value,e._path,!0);const t=Mi(e._queryParams,this._value,this._key);if(di(t),qe(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new re(e._repo,e._path,t,e._orderByCalled)}}class fu extends Te{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){Pe("startAfter",this._value,e._path,!1);const t=function ya(n,e,t){let i;return i=Mi(n,e,n.index_===Ne||t?t:me),i.startAfterSet_=!0,i}(e._queryParams,this._value,this._key);if(di(t),qe(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new re(e._repo,e._path,t,e._orderByCalled)}}class pu extends Te{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new re(e._repo,e._path,function ma(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}(e._queryParams,this._limit),e._orderByCalled)}}class mu extends Te{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new re(e._repo,e._path,function va(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}(e._queryParams,this._limit),e._orderByCalled)}}class yu extends Te{constructor(e){super(),this._path=e}_apply(e){hi(e,"orderByChild");const t=new O(this._path);if(A(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const i=new Di(t),s=Gn(e._queryParams,i);return qe(s),new re(e._repo,e._path,s,!0)}}class Eu extends Te{_apply(e){hi(e,"orderByKey");const t=Gn(e._queryParams,Ne);return qe(t),new re(e._repo,e._path,t,!0)}}class Iu extends Te{_apply(e){hi(e,"orderByPriority");const t=Gn(e._queryParams,W);return qe(t),new re(e._repo,e._path,t,!0)}}class Su extends Te{_apply(e){hi(e,"orderByValue");const t=Gn(e._queryParams,Oi);return qe(t),new re(e._repo,e._path,t,!0)}}class Ru extends Te{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(Pe("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new oo(this._value,this._key)._apply(new ao(this._value,this._key)._apply(e))}}function Se(n,...e){let t=(0,u.m9)(n);for(const i of e)t=i._apply(t);return t}(function ll(n){(0,u.hu)(!Xn,"__referenceConstructor has already been defined"),Xn=n})(pe),function fl(n){(0,u.hu)(!ei,"__referenceConstructor has already been defined"),ei=n}(pe);const Ts={};function uo(n,e,t,i,s){let r=i||n.options.databaseURL;void 0===r&&(n.options.projectId||ce("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),z("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let l,c,o=ys(r,s),a=o.repoInfo;typeof process<"u"&&process.env&&(c=process.env.FIREBASE_DATABASE_EMULATOR_HOST),c?(l=!0,r=`http://${c}?ns=${a.namespace}`,o=ys(r,s),a=o.repoInfo):l=!o.repoInfo.secure;const _=s&&l?new Me(Me.OWNER):new Ci(n.name,n.options,e);Fr("Invalid Firebase Database URL",o),A(o.path)||ce("Database URL must point to the root of a Firebase Database (not including a child path).");const g=function xu(n,e,t,i){let s=Ts[e.name];s||(s={},Ts[e.name]=s);let r=s[n.toURLString()];return r&&ce("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Bl(n,false,t,i),s[n.toURLString()]=r,r}(a,n,_,new An(n.name,t));return new Ou(g,n)}class Ou{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function Vl(n,e,t){if(n.stats_=wt(n.repoInfo_),n.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)n.server_=new Hn(n.repoInfo_,(i,s,r,o)=>{Gr(n,i,s,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Hr(n,!0),0);else{if(typeof t<"u"&&null!==t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,u.Wl)(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new lt(n.repoInfo_,e,(i,s,r,o)=>{Gr(n,i,s,r,o)},i=>{Hr(n,i)},i=>{!function Gl(n,e){$(e,(t,i)=>{fs(n,t,i)})}(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=function Ei(n,e){const t=n.toString();return Et[t]||(Et[t]=e()),Et[t]}(n.repoInfo_,()=>new ba(n.stats_,n.server_)),n.infoData_=new Ea,n.infoSyncTree_=new br({startListening:(i,s,r,o)=>{let a=[];const l=n.infoData_.getNode(i._path);return l.isEmpty()||(a=on(n.infoSyncTree_,i._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),fs(n,"connected",!1),n.serverSyncTree_=new br({startListening:(i,s,r,o)=>(n.server_.listen(i,r,s,(a,l)=>{const c=o(a,l);oe(n.eventQueue_,i._path,c)}),[]),stopListening:(i,s)=>{n.server_.unlisten(i,s)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new pe(this._repo,D())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function ku(n,e){const t=Ts[e];(!t||t[n.key]!==n)&&ce(`Database ${e}(${n.repoInfo_}) has already been deleted.`),$r(n),delete t[n.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&ce("Cannot call "+e+" on a deleted database.")}}function co(){xs.IS_TRANSPORT_INITIALIZED&&j("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function Lu(){co(),Ee.forceDisallow()}function Mu(){co(),It.forceDisallow(),Ee.forceAllow()}function Fu(n=(0,ne.getApp)(),e){const t=(0,ne._getProvider)(n,"database").getImmediate({identifier:e}),i=(0,u.P0)("database");return i&&ho(t,...i),t}function ho(n,e,t,i={}){(n=(0,u.m9)(n))._checkNotDeleted("useEmulator"),n._instanceStarted&&ce("Cannot call useEmulator() after instance has already been initialized.");const s=n._repoInternal;let r;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&ce('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new Me(Me.OWNER);else if(i.mockUserToken){const o="string"==typeof i.mockUserToken?i.mockUserToken:(0,u.Sg)(i.mockUserToken,n.app.options.projectId);r=new Me(o)}!function Pu(n,e,t,i){n.repoInfo_=new ot(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams),i&&(n.authTokenProvider_=i)}(s,e,t,r)}function Bu(n,e){vt(n,e)}const Gu={".sv":"timestamp"};class $u{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}lt.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)},lt.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)},function Vu(n){wn(ne.SDK_VERSION),(0,ne._registerComponent)(new ue.wA("database",(e,{instanceIdentifier:t})=>uo(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),(0,ne.registerVersion)(En,"0.14.0",n),(0,ne.registerVersion)(En,"0.14.0","esm2017")}();const qu=(0,F.u3)(Xe,!0),Xu=(0,F.u3)(Fu,!0),Ju=(0,F.u3)(eo,!0),ec=(0,F.u3)(Es,!0);var mn=I(1368),tc=I(4986),Rs=I(9751),vn=I(9646),As=I(6451),_o=I(3099),po=I(5026),nc=I(1884),go=I(4482),Ns=I(5403),ic=I(8421),sc=I(4671),rc=I(5032),oc=I(3269),ke=I(2011),uc=(I(9568),I(3942));const dc=new Lt.Yd("@firebase/database-compat"),mo=function(n){dc.warn("FIREBASE WARNING: "+n)};class pc{constructor(e){this._delegate=e}cancel(e){(0,u.Dv)("OnDisconnect.cancel",0,1,arguments.length),(0,u.Wj)("OnDisconnect.cancel","onComplete",e,!0);const t=this._delegate.cancel();return e&&t.then(()=>e(null),i=>e(i)),t}remove(e){(0,u.Dv)("OnDisconnect.remove",0,1,arguments.length),(0,u.Wj)("OnDisconnect.remove","onComplete",e,!0);const t=this._delegate.remove();return e&&t.then(()=>e(null),i=>e(i)),t}set(e,t){(0,u.Dv)("OnDisconnect.set",1,2,arguments.length),(0,u.Wj)("OnDisconnect.set","onComplete",t,!0);const i=this._delegate.set(e);return t&&i.then(()=>t(null),s=>t(s)),i}setWithPriority(e,t,i){(0,u.Dv)("OnDisconnect.setWithPriority",2,3,arguments.length),(0,u.Wj)("OnDisconnect.setWithPriority","onComplete",i,!0);const s=this._delegate.setWithPriority(e,t);return i&&s.then(()=>i(null),r=>i(r)),s}update(e,t){if((0,u.Dv)("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){const s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,mo("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}(0,u.Wj)("OnDisconnect.update","onComplete",t,!0);const i=this._delegate.update(e);return t&&i.then(()=>t(null),s=>t(s)),i}}class gc{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return(0,u.Dv)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}class Je{constructor(e,t){this._database=e,this._delegate=t}val(){return(0,u.Dv)("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return(0,u.Dv)("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return(0,u.Dv)("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return(0,u.Dv)("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return(0,u.Dv)("DataSnapshot.child",0,1,arguments.length),e=String(e),fn("DataSnapshot.child","path",e,!1),new Je(this._database,this._delegate.child(e))}hasChild(e){return(0,u.Dv)("DataSnapshot.hasChild",1,1,arguments.length),fn("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return(0,u.Dv)("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return(0,u.Dv)("DataSnapshot.forEach",1,1,arguments.length),(0,u.Wj)("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new Je(this._database,t)))}hasChildren(){return(0,u.Dv)("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return(0,u.Dv)("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return(0,u.Dv)("DataSnapshot.ref",0,0,arguments.length),new ae(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class Z{constructor(e,t){this.database=e,this._delegate=t}on(e,t,i,s){var r;(0,u.Dv)("Query.on",2,4,arguments.length),(0,u.Wj)("Query.on","callback",t,!1);const o=Z.getCancelAndContextArgs_("Query.on",i,s),a=(c,_)=>{t.call(o.context,new Je(this.database,c),_)};a.userCallback=t,a.context=o.context;const l=null===(r=o.cancel)||void 0===r?void 0:r.bind(o.context);switch(e){case"value":return Is(this._delegate,a,l),t;case"child_added":return to(this._delegate,a,l),t;case"child_removed":return so(this._delegate,a,l),t;case"child_changed":return no(this._delegate,a,l),t;case"child_moved":return io(this._delegate,a,l),t;default:throw new Error((0,u.gK)("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,i){if((0,u.Dv)("Query.off",0,3,arguments.length),function(n,e,t){if(void 0!==e)switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error((0,u.gK)("Query.off","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}(0,e),(0,u.Wj)("Query.off","callback",t,!0),(0,u.lb)("Query.off","context",i,!0),t){const s=()=>{};s.userCallback=t,s.context=i,ro(this._delegate,e,s)}else ro(this._delegate,e)}get(){return lu(this._delegate).then(e=>new Je(this.database,e))}once(e,t,i,s){(0,u.Dv)("Query.once",1,4,arguments.length),(0,u.Wj)("Query.once","callback",t,!0);const r=Z.getCancelAndContextArgs_("Query.once",i,s),o=new u.BH,a=(c,_)=>{const g=new Je(this.database,c);t&&t.call(r.context,g,_),o.resolve(g)};a.userCallback=t,a.context=r.context;const l=c=>{r.cancel&&r.cancel.call(r.context,c),o.reject(c)};switch(e){case"value":Is(this._delegate,a,l,{onlyOnce:!0});break;case"child_added":to(this._delegate,a,l,{onlyOnce:!0});break;case"child_removed":so(this._delegate,a,l,{onlyOnce:!0});break;case"child_changed":no(this._delegate,a,l,{onlyOnce:!0});break;case"child_moved":io(this._delegate,a,l,{onlyOnce:!0});break;default:throw new Error((0,u.gK)("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return(0,u.Dv)("Query.limitToFirst",1,1,arguments.length),new Z(this.database,Se(this._delegate,function gu(n){if("number"!=typeof n||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new pu(n)}(e)))}limitToLast(e){return(0,u.Dv)("Query.limitToLast",1,1,arguments.length),new Z(this.database,Se(this._delegate,function vu(n){if("number"!=typeof n||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new mu(n)}(e)))}orderByChild(e){return(0,u.Dv)("Query.orderByChild",1,1,arguments.length),new Z(this.database,Se(this._delegate,function Cu(n){if("$key"===n)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===n)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===n)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return fn("orderByChild","path",n,!1),new yu(n)}(e)))}orderByKey(){return(0,u.Dv)("Query.orderByKey",0,0,arguments.length),new Z(this.database,Se(this._delegate,function wu(){return new Eu}()))}orderByPriority(){return(0,u.Dv)("Query.orderByPriority",0,0,arguments.length),new Z(this.database,Se(this._delegate,function Tu(){return new Iu}()))}orderByValue(){return(0,u.Dv)("Query.orderByValue",0,0,arguments.length),new Z(this.database,Se(this._delegate,function bu(){return new Su}()))}startAt(e=null,t){return(0,u.Dv)("Query.startAt",0,2,arguments.length),new Z(this.database,Se(this._delegate,function du(n=null,e){return dn("startAt","key",e,!0),new ao(n,e)}(e,t)))}startAfter(e=null,t){return(0,u.Dv)("Query.startAfter",0,2,arguments.length),new Z(this.database,Se(this._delegate,function _u(n,e){return dn("startAfter","key",e,!0),new fu(n,e)}(e,t)))}endAt(e=null,t){return(0,u.Dv)("Query.endAt",0,2,arguments.length),new Z(this.database,Se(this._delegate,function uu(n,e){return dn("endAt","key",e,!0),new oo(n,e)}(e,t)))}endBefore(e=null,t){return(0,u.Dv)("Query.endBefore",0,2,arguments.length),new Z(this.database,Se(this._delegate,function hu(n,e){return dn("endBefore","key",e,!0),new cu(n,e)}(e,t)))}equalTo(e,t){return(0,u.Dv)("Query.equalTo",1,2,arguments.length),new Z(this.database,Se(this._delegate,function Au(n,e){return dn("equalTo","key",e,!0),new Ru(n,e)}(e,t)))}toString(){return(0,u.Dv)("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return(0,u.Dv)("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if((0,u.Dv)("Query.isEqual",1,1,arguments.length),!(e instanceof Z))throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.");return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,i){const s={cancel:void 0,context:void 0};if(t&&i)s.cancel=t,(0,u.Wj)(e,"cancel",s.cancel,!0),s.context=i,(0,u.lb)(e,"context",s.context,!0);else if(t)if("object"==typeof t&&null!==t)s.context=t;else{if("function"!=typeof t)throw new Error((0,u.gK)(e,"cancelOrContext")+" must either be a cancel callback or a context object.");s.cancel=t}return s}get ref(){return new ae(this.database,new pe(this._delegate._repo,this._delegate._path))}}class ae extends Z{constructor(e,t){super(e,new re(t._repo,t._path,new Vn,!1)),this.database=e,this._delegate=t}getKey(){return(0,u.Dv)("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return(0,u.Dv)("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new ae(this.database,Xe(this._delegate,e))}getParent(){(0,u.Dv)("Reference.parent",0,0,arguments.length);const e=this._delegate.parent;return e?new ae(this.database,e):null}getRoot(){return(0,u.Dv)("Reference.root",0,0,arguments.length),new ae(this.database,this._delegate.root)}set(e,t){(0,u.Dv)("Reference.set",1,2,arguments.length),(0,u.Wj)("Reference.set","onComplete",t,!0);const i=ws(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}update(e,t){if((0,u.Dv)("Reference.update",1,2,arguments.length),Array.isArray(e)){const s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,mo("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}_e("Reference.update",this._delegate._path),(0,u.Wj)("Reference.update","onComplete",t,!0);const i=au(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}setWithPriority(e,t,i){(0,u.Dv)("Reference.setWithPriority",2,3,arguments.length),(0,u.Wj)("Reference.setWithPriority","onComplete",i,!0);const s=function ou(n,e,t){if(_e("setWithPriority",n._path),Pe("setWithPriority",e,n._path,!1),ds("setWithPriority",t,!1),".length"===n.key||".keys"===n.key)throw"setWithPriority failed: "+n.key+" is a read-only object.";const i=new u.BH;return _s(n._repo,n._path,e,t,i.wrapCallback(()=>{})),i.promise}(this._delegate,e,t);return i&&s.then(()=>i(null),r=>i(r)),s}remove(e){(0,u.Dv)("Reference.remove",0,1,arguments.length),(0,u.Wj)("Reference.remove","onComplete",e,!0);const t=function su(n){return _e("remove",n._path),ws(n,null)}(this._delegate);return e&&t.then(()=>e(null),i=>e(i)),t}transaction(e,t,i){(0,u.Dv)("Reference.transaction",1,3,arguments.length),(0,u.Wj)("Reference.transaction","transactionUpdate",e,!1),(0,u.Wj)("Reference.transaction","onComplete",t,!0),function(n,e,t,i){if(void 0!==t&&"boolean"!=typeof t)throw new Error((0,u.gK)("Reference.transaction","applyLocally")+"must be a boolean.")}(0,0,i);const s=function Qu(n,e,t){var i;if(n=(0,u.m9)(n),_e("Reference.transaction",n._path),".length"===n.key||".keys"===n.key)throw"Reference.transaction failed: "+n.key+" is a read-only object.";const s=null===(i=t?.applyLocally)||void 0===i||i,r=new u.BH,a=Is(n,()=>{});return function ql(n,e,t,i,s,r){kt(n,"transaction on "+e);const o={path:e,update:t,onComplete:i,status:null,order:Ut(),applyLocally:r,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=gs(n,e,void 0);o.currentInputSnapshot=a;const l=o.update(a.val());if(void 0===l)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{hn("transaction failed: Data returned ",l,o.path),o.status=0;const c=si(n.transactionQueueTree_,e),_=dt(c)||[];let g;_.push(o),us(c,_),"object"==typeof l&&null!==l&&(0,u.r3)(l,".priority")?(g=(0,u.DV)(l,".priority"),(0,u.hu)(cn(g),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):g=(ni(n.serverSyncTree_,e)||S.EMPTY_NODE).getPriority().val();const m=_n(n),C=H(l,g),w=os(C,a,m);o.currentOutputSnapshotRaw=C,o.currentOutputSnapshotResolved=w,o.currentWriteId=li(n);const N=Ji(n.serverSyncTree_,e,w,o.currentWriteId,o.applyLocally);oe(n.eventQueue_,e,N),ui(n,n.transactionQueueTree_)}}(n._repo,n._path,e,(l,c,_)=>{let g=null;l?r.reject(l):(g=new ft(_,new pe(n._repo,n._path),W),r.resolve(new $u(c,g)))},a,s),r.promise}(this._delegate,e,{applyLocally:i}).then(r=>new gc(r.committed,new Je(this.database,r.snapshot)));return t&&s.then(r=>t(null,r.committed,r.snapshot),r=>t(r,!1,null)),s}setPriority(e,t){(0,u.Dv)("Reference.setPriority",1,2,arguments.length),(0,u.Wj)("Reference.setPriority","onComplete",t,!0);const i=function ru(n,e){n=(0,u.m9)(n),_e("setPriority",n._path),ds("setPriority",e,!1);const t=new u.BH;return _s(n._repo,B(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}push(e,t){(0,u.Dv)("Reference.push",0,2,arguments.length),(0,u.Wj)("Reference.push","onComplete",t,!0);const i=eo(this._delegate,e),s=i.then(o=>new ae(this.database,o));t&&s.then(()=>t(null),o=>t(o));const r=new ae(this.database,i);return r.then=s.then.bind(s),r.catch=s.catch.bind(s,void 0),r}onDisconnect(){return _e("Reference.onDisconnect",this._delegate._path),new pc(new Xr(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}class yn{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:Lu,forceLongPolling:Mu}}useEmulator(e,t,i={}){ho(this._delegate,e,t,i)}ref(e){if((0,u.Dv)("database.ref",0,1,arguments.length),e instanceof ae){const t=Jr(this._delegate,e.toString());return new ae(this,t)}{const t=Es(this._delegate,e);return new ae(this,t)}}refFromURL(e){(0,u.Dv)("database.refFromURL",1,1,arguments.length);const i=Jr(this._delegate,e);return new ae(this,i)}goOffline(){return(0,u.Dv)("database.goOffline",0,0,arguments.length),function Wu(n){(n=(0,u.m9)(n))._checkNotDeleted("goOffline"),$r(n._repo)}(this._delegate)}goOnline(){return(0,u.Dv)("database.goOnline",0,0,arguments.length),function Uu(n){(n=(0,u.m9)(n))._checkNotDeleted("goOnline"),function Zl(n){n.persistentConnection_&&n.persistentConnection_.resume(Br)}(n._repo)}(this._delegate)}}yn.ServerValue={TIMESTAMP:function Hu(){return Gu}(),increment:n=>function zu(n){return{".sv":{increment:n}}}(n)};var vc=Object.freeze({__proto__:null,initStandalone:function mc({app:n,url:e,version:t,customAuthImpl:i,namespace:s,nodeAdmin:r=!1}){wn(t);const o=new ue.zt("auth-internal",new ue.H0("database-standalone"));return o.setComponent(new ue.wA("auth-internal",()=>i,"PRIVATE")),{instance:new yn(uo(n,o,void 0,e,r),n),namespace:s}}});const yc=yn.ServerValue;!function Cc(n){n.INTERNAL.registerComponent(new ue.wA("database-compat",(e,{instanceIdentifier:t})=>{const i=e.getProvider("app-compat").getImmediate(),s=e.getProvider("database").getImmediate({identifier:t});return new yn(s,i)},"PUBLIC").setServiceProps({Reference:ae,Query:Z,Database:yn,DataSnapshot:Je,enableLogging:Bu,INTERNAL:vc,ServerValue:yc}).setMultipleInstances(!0)),n.registerVersion("@firebase/database-compat","0.3.0")}(uc.Z);var Ec=I(7579),_i=I(5363),wc=I(4707);function vo(n,e,t){let i,s=!1;return n&&"object"==typeof n?({bufferSize:i=1/0,windowTime:e=1/0,refCount:s=!1,scheduler:t}=n):i=n??1/0,(0,_o.B)({connector:()=>new wc.t(i,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:s})}var Ic=I(590),Tc=I(576);function yo(n,e){return(0,Tc.m)(e)?(0,f.w)(()=>n,e):(0,f.w)(()=>n)}var Ps=I(9468),Sc=I(9300),bc=I(6895),Co=I(2313);I(9260);const Eo=new E.OlP("angularfire2.auth.use-emulator"),wo=new E.OlP("angularfire2.auth.settings"),Io=new E.OlP("angularfire2.auth.tenant-id"),To=new E.OlP("angularfire2.auth.langugage-code"),So=new E.OlP("angularfire2.auth.use-device-language"),bo=new E.OlP("angularfire.auth.persistence"),Ro=(n,e,t,i,s,r,o,a)=>(0,ke.cc)(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{const l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),i&&(l.tenantId=i),l.languageCode=s,r&&l.useDeviceLanguage(),o)for(const[c,_]of Object.entries(o))l.settings[c]=_;return a&&l.setPersistence(a),l},[t,i,s,r,o,a]);let Ao=(()=>{class n{constructor(t,i,s,r,o,a,l,c,_,g,m,C){const w=new Ec.x,N=(0,vn.of)(void 0).pipe((0,_i.Q)(o.outsideAngular),(0,f.w)(()=>r.runOutsideAngular(()=>Promise.resolve().then(I.bind(I,9568)))),(0,T.U)(()=>(0,ke.on)(t,r,i)),(0,T.U)(V=>Ro(V,r,a,c,_,g,l,m)),vo({bufferSize:1,refCount:!1}));if((0,bc.PM)(s))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,vn.of)(null);else{N.pipe((0,Ic.P)()).subscribe();const te=N.pipe((0,f.w)(Q=>Q.getRedirectResult().then(Ue=>Ue,()=>null)),F.iC,vo({bufferSize:1,refCount:!1})),le=N.pipe((0,f.w)(Q=>new Rs.y(Ue=>({unsubscribe:r.runOutsideAngular(()=>Q.onAuthStateChanged(_t=>Ue.next(_t),_t=>Ue.error(_t),()=>Ue.complete()))})))),xe=N.pipe((0,f.w)(Q=>new Rs.y(Ue=>({unsubscribe:r.runOutsideAngular(()=>Q.onIdTokenChanged(_t=>Ue.next(_t),_t=>Ue.error(_t),()=>Ue.complete()))}))));this.authState=te.pipe(yo(le),(0,Ps.R)(o.outsideAngular),(0,_i.Q)(o.insideAngular)),this.user=te.pipe(yo(xe),(0,Ps.R)(o.outsideAngular),(0,_i.Q)(o.insideAngular)),this.idToken=this.user.pipe((0,f.w)(Q=>Q?(0,G.D)(Q.getIdToken()):(0,vn.of)(null))),this.idTokenResult=this.user.pipe((0,f.w)(Q=>Q?(0,G.D)(Q.getIdTokenResult()):(0,vn.of)(null))),this.credential=(0,As.T)(te,w,this.authState.pipe((0,Sc.h)(Q=>!Q))).pipe((0,T.U)(Q=>Q?.user?Q:null),(0,Ps.R)(o.outsideAngular),(0,_i.Q)(o.insideAngular))}return(0,ke.pX)(this,N,r,{spy:{apply:(V,te,le)=>{(V.startsWith("signIn")||V.startsWith("createUser"))&&le.then(xe=>w.next(xe))}}})}}return n.\u0275fac=function(t){return new(t||n)(E.LFG(ke.Dh),E.LFG(ke.xv,8),E.LFG(E.Lbi),E.LFG(E.R0b),E.LFG(F.HU),E.LFG(Eo,8),E.LFG(wo,8),E.LFG(Io,8),E.LFG(To,8),E.LFG(So,8),E.LFG(bo,8),E.LFG(Co.nm,8))},n.\u0275prov=E.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();function No(n){return null==n}function Po(n){return"function"==typeof n.set}function ko(n,e){return Po(e)?e:n.ref(e)}function xo(n,e){if(function Ac(n){return"string"==typeof n}(n))return e.stringCase();if(Po(n))return e.firebaseCase();if(function Nc(n){return"function"==typeof n.exportVal}(n))return e.snapshotCase();throw new Error("Expects a string, snapshot, or reference. Got: "+typeof n)}function Cn(n,e,t="on",i=tc.z){return new Rs.y(s=>{let r=null;return r=n[t](e,(o,a)=>{i.schedule(()=>{s.next({snapshot:o,prevKey:a})}),"once"===t&&i.schedule(()=>s.complete())},o=>{i.schedule(()=>s.error(o))}),"on"===t?{unsubscribe(){null!=r&&n.off(e,r)}}:{unsubscribe(){}}}).pipe((0,T.U)(s=>{const{snapshot:r,prevKey:o}=s;let a=null;return r.exists()&&(a=r.key),{type:e,payload:r,prevKey:o,key:a}}),(0,_o.B)())}function Do(n,e){const t=n.length;for(let i=0;i<t;i++)if(n[i].payload.key===e)return i;return-1}function xc(n,e){const{payload:t,prevKey:i,key:s}=e,r=Do(n,s),o=function kc(n,e){if(No(e))return 0;{const t=Do(n,e);return-1===t?n.length:t+1}}(n,i);switch(e.type){case"value":if(e.payload&&e.payload.exists()){let a=null;e.payload.forEach(l=>{const c={payload:l,type:"value",prevKey:a,key:l.key};return a=l.key,n=[...n,c],!1})}return n;case"child_added":if(r>-1){const a=n[r-1];(a&&a.key||null)!==i&&(n=n.filter(l=>l.payload.key!==t.key)).splice(o,0,e)}else{if(null==i)return[e,...n];(n=n.slice()).splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===s?e:a);case"child_moved":if(r>-1){const a=n.splice(r,1)[0];return(n=n.slice()).splice(o,0,a),n}return n;default:return n}}function Oo(n){return(No(n)||0===n.length)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function Lo(n,e,t){return function Pc(n,e,t){return Cn(n,"value","once",t).pipe((0,f.w)(i=>{const s=[(0,vn.of)(i)];return e.forEach(r=>s.push(Cn(n,r,"on",t))),(0,As.T)(...s).pipe((0,po.R)(xc,[]))}),(0,nc.x)())}(n,e=Oo(e),t)}function Mo(n,e,t){const i=(e=Oo(e)).map(s=>Cn(n,s,"on",t));return(0,As.T)(...i)}function Fo(n,e){return function(i,s){return xo(i,{stringCase:()=>n.child(i)[e](s),firebaseCase:()=>i[e](s),snapshotCase:()=>i.ref[e](s)})}}function Mc(n){return function(t){return t?xo(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function Wo(n,e){return function(){return Cn(n,"value","on",e)}}const Uc=new E.OlP("angularfire2.realtimeDatabaseURL"),Bc=new E.OlP("angularfire2.database.use-emulator");let Vc=(()=>{class n{constructor(t,i,s,r,o,a,l,c,_,g,m,C,w,N,V){this.schedulers=a;const te=l,le=(0,ke.on)(t,o,i);c&&Ro(le,o,_,m,C,w,g,N),this.database=(0,ke.cc)(`${le.name}.database.${s}`,"AngularFireDatabase",le.name,()=>{const xe=o.runOutsideAngular(()=>le.database(s||void 0));return te&&xe.useEmulator(...te),xe},[te])}list(t,i){const s=this.schedulers.ngZone.runOutsideAngular(()=>ko(this.database,t));let r=s;return i&&(r=i(s)),function Fc(n,e){const t=e.schedulers.outsideAngular,i=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:Fo(i,"update"),set:Fo(i,"set"),push:s=>i.push(s),remove:Mc(i),snapshotChanges:s=>Lo(n,s,t).pipe(F.iC),stateChanges:s=>Mo(n,s,t).pipe(F.iC),auditTrail:s=>function Dc(n,e,t){return function Lc(n,e,t){return function Oc(n,e){return Cn(n,"value","on",e).pipe((0,T.U)(t=>{let i;return t.payload.forEach(s=>(i=s.key,!1)),{data:t,lastKeyToLoad:i}}))}(n,t).pipe(function ac(...n){const e=(0,oc.jO)(n);return(0,go.e)((t,i)=>{const s=n.length,r=new Array(s);let o=n.map(()=>!1),a=!1;for(let l=0;l<s;l++)(0,ic.Xf)(n[l]).subscribe((0,Ns.x)(i,c=>{r[l]=c,!a&&!o[l]&&(o[l]=!0,(a=o.every(sc.y))&&(o=null))},rc.Z));t.subscribe((0,Ns.x)(i,l=>{if(a){const c=[l,...r];i.next(e?e(...c):c)}}))})}(e),(0,T.U)(([s,r])=>{const o=s.lastKeyToLoad,a=r.map(l=>l.key);return{actions:r,lastKeyToLoad:o,loadedKeys:a}}),function lc(n){return(0,go.e)((e,t)=>{let i=!1,s=0;e.subscribe((0,Ns.x)(t,r=>(i||(i=!n(r,s++)))&&t.next(r)))})}(s=>-1===s.loadedKeys.indexOf(s.lastKeyToLoad)),(0,T.U)(s=>s.actions))}(n,Mo(n,e).pipe((0,po.R)((s,r)=>[...s,r],[])),t)}(n,s,t).pipe(F.iC),valueChanges:(s,r)=>Lo(n,s,t).pipe((0,T.U)(a=>a.map(l=>r&&r.idField?Object.assign(Object.assign({},l.payload.val()),{[r.idField]:l.key}):l.payload.val())),F.iC)}}(r,this)}object(t){return function Wc(n,e){return{query:n,snapshotChanges:()=>Wo(n,e.schedulers.outsideAngular)().pipe(F.iC),update:t=>n.ref.update(t),set:t=>n.ref.set(t),remove:()=>n.ref.remove(),valueChanges:()=>Wo(n,e.schedulers.outsideAngular)().pipe(F.iC,(0,T.U)(i=>i.payload.exists()?i.payload.val():null))}}(this.schedulers.ngZone.runOutsideAngular(()=>ko(this.database,t)),this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}}return n.\u0275fac=function(t){return new(t||n)(E.LFG(ke.Dh),E.LFG(ke.xv,8),E.LFG(Uc,8),E.LFG(E.Lbi),E.LFG(E.R0b),E.LFG(F.HU),E.LFG(Bc,8),E.LFG(Ao,8),E.LFG(Eo,8),E.LFG(wo,8),E.LFG(Io,8),E.LFG(To,8),E.LFG(So,8),E.LFG(bo,8),E.LFG(Co.nm,8))},n.\u0275prov=E.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();class Dt{constructor(e,t){this._db=e,this._storage=t}get(){return this._db.list("products").valueChanges()}getById(e){return this.get().pipe((0,T.U)(t=>t.find(i=>i.id===e)))}getFavorite(){return this._db.list("products",e=>e.orderByChild("favorite").equalTo(!0)).valueChanges()}setFavorite(e,t){this._db.list("products").set(`${e}/favorite`,t)}post(e,t){const i=Xu(),s=Ju(qu(ec(i),"products")).key;return s?this.postImage(t).pipe((0,f.w)(r=>this._db.list("products").set(`${s}`,{...e,image:r,favorite:!1,id:s})),(0,T.U)(()=>s)):et.E}postImage(e){const t=`catalog/${Math.floor(Date.now()/1e3)}-${e.name}`,i=(0,mn.iH)(this._storage,t);return(0,G.D)((0,mn.KV)(i,e)).pipe((0,f.w)(()=>(0,mn.Jt)((0,mn.iH)(this._storage,t))))}nameExists(e){return this.get().pipe((0,T.U)(t=>!!t.find(i=>i.name.toLocaleLowerCase()===e.toLocaleLowerCase())),(0,q.q)(1))}}Dt.\u0275fac=function(e){return new(e||Dt)(E.LFG(Vc),E.LFG(mn.Ke))},Dt.\u0275prov=E.Yz7({token:Dt,factory:Dt.\u0275fac,providedIn:"root"})},4707:(ks,Ot,I)=>{I.d(Ot,{t:()=>f});var T=I(7579),et=I(6063);class f extends T.x{constructor(q=1/0,F=1/0,E=et.l){super(),this._bufferSize=q,this._windowTime=F,this._timestampProvider=E,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=F===1/0,this._bufferSize=Math.max(1,q),this._windowTime=Math.max(1,F)}next(q){const{isStopped:F,_buffer:E,_infiniteTimeWindow:X,_timestampProvider:be,_windowTime:ge}=this;F||(E.push(q),!X&&E.push(be.now()+ge)),this._trimBuffer(),super.next(q)}_subscribe(q){this._throwIfClosed(),this._trimBuffer();const F=this._innerSubscribe(q),{_infiniteTimeWindow:E,_buffer:X}=this,be=X.slice();for(let ge=0;ge<be.length&&!q.closed;ge+=E?1:2)q.next(be[ge]);return this._checkFinalizedStatuses(q),F}_trimBuffer(){const{_bufferSize:q,_timestampProvider:F,_buffer:E,_infiniteTimeWindow:X}=this,be=(X?1:2)*q;if(q<1/0&&be<E.length&&E.splice(0,E.length-be),!X){const ge=F.now();let ne=0;for(let ue=1;ue<E.length&&E[ue]<=ge;ue+=2)ne=ue;ne&&E.splice(0,ne+1)}}}},9568:(ks,Ot,I)=>{I.r(Ot);var T=I(5861),et=I(3942),f=I(552),G=I(2090),E=(I(9681),I(1877),I(3475));function X(){return window}function ne(){return(ne=(0,T.Z)(function*(p,d,h){var v;const{BuildInfo:y}=X();(0,f.ap)(d.sessionId,"AuthEvent did not contain a session ID");const b=yield wn(d.sessionId),k={};return(0,f.aq)()?k.ibi=y.packageName:(0,f.ar)()?k.apn=y.packageName:(0,f.as)(p,"operation-not-supported-in-this-environment"),y.displayName&&(k.appDisplayName=y.displayName),k.sessionId=b,(0,f.at)(p,h,d.type,void 0,null!==(v=d.eventId)&&void 0!==v?v:void 0,k)})).apply(this,arguments)}function u(){return(u=(0,T.Z)(function*(p){const{BuildInfo:d}=X(),h={};(0,f.aq)()?h.iosBundleId=d.packageName:(0,f.ar)()?h.androidPackageName=d.packageName:(0,f.as)(p,"operation-not-supported-in-this-environment"),yield(0,f.au)(p,h)})).apply(this,arguments)}function pt(){return(pt=(0,T.Z)(function*(p,d,h){const{cordova:v}=X();let y=()=>{};try{yield new Promise((b,k)=>{let L=null;function K(){var x;b();const Ae=null===(x=v.plugins.browsertab)||void 0===x?void 0:x.close;"function"==typeof Ae&&Ae(),"function"==typeof h?.close&&h.close()}function ie(){L||(L=window.setTimeout(()=>{k((0,f.aw)(p,"redirect-cancelled-by-user"))},2e3))}function he(){"visible"===document?.visibilityState&&ie()}d.addPassiveListener(K),document.addEventListener("resume",ie,!1),(0,f.ar)()&&document.addEventListener("visibilitychange",he,!1),y=()=>{d.removePassiveListener(K),document.removeEventListener("resume",ie,!1),document.removeEventListener("visibilitychange",he,!1),L&&window.clearTimeout(L)}})}finally{y()}})).apply(this,arguments)}function wn(p){return Ft.apply(this,arguments)}function Ft(){return(Ft=(0,T.Z)(function*(p){const d=pi(p),h=yield crypto.subtle.digest("SHA-256",d);return Array.from(new Uint8Array(h)).map(y=>y.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}function pi(p){if((0,f.ap)(/[0-9a-zA-Z]+/.test(p),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return(new TextEncoder).encode(p);const d=new ArrayBuffer(p.length),h=new Uint8Array(d);for(let v=0;v<p.length;v++)h[v]=p.charCodeAt(v);return h}class De extends f.ay{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(d=>{this.resolveInialized=d})}addPassiveListener(d){this.passiveListeners.add(d)}removePassiveListener(d){this.passiveListeners.delete(d)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(d){return this.resolveInialized(),this.passiveListeners.forEach(h=>h(d)),super.onEvent(d)}initialized(){var d=this;return(0,T.Z)(function*(){yield d.initPromise})()}}function Ut(p){return gt.apply(this,arguments)}function gt(){return(gt=(0,T.Z)(function*(p){const d=yield mt()._get(vt(p));return d&&(yield mt()._remove(vt(p))),d})).apply(this,arguments)}function Oe(){const p=[],d="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let h=0;h<20;h++){const v=Math.floor(Math.random()*d.length);p.push(d.charAt(v))}return p.join("")}function mt(){return(0,f.az)(f.b)}function vt(p){return(0,f.aA)("authEvent",p.config.apiKey,p.name)}function Ve(p){if(!p?.includes("?"))return{};const[d,...h]=p.split("?");return(0,G.zd)(h.join("?"))}const gi=class j{constructor(){this._redirectPersistence=f.a,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=f.aB,this._overrideRedirectResult=f.aC}_initialize(d){var h=this;return(0,T.Z)(function*(){const v=d._key();let y=h.eventManagers.get(v);return y||(y=new De(d),h.eventManagers.set(v,y),h.attachCallbackListeners(d,y)),y})()}_openPopup(d){(0,f.as)(d,"operation-not-supported-in-this-environment")}_openRedirect(d,h,v,y){var b=this;return(0,T.Z)(function*(){!function Mt(p){var d,h,v,y,b,k,L,K,ie,he;const x=X();(0,f.ax)("function"==typeof(null===(d=x?.universalLinks)||void 0===d?void 0:d.subscribe),p,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),(0,f.ax)(typeof(null===(h=x?.BuildInfo)||void 0===h?void 0:h.packageName)<"u",p,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),(0,f.ax)("function"==typeof(null===(b=null===(y=null===(v=x?.cordova)||void 0===v?void 0:v.plugins)||void 0===y?void 0:y.browsertab)||void 0===b?void 0:b.openUrl),p,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,f.ax)("function"==typeof(null===(K=null===(L=null===(k=x?.cordova)||void 0===k?void 0:k.plugins)||void 0===L?void 0:L.browsertab)||void 0===K?void 0:K.isAvailable),p,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),(0,f.ax)("function"==typeof(null===(he=null===(ie=x?.cordova)||void 0===ie?void 0:ie.InAppBrowser)||void 0===he?void 0:he.open),p,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(d);const k=yield b._initialize(d);yield k.initialized(),k.resetRedirect(),(0,f.aD)(),yield b._originValidation(d);const L=function Wt(p,d,h=null){return{type:d,eventId:h,urlResponse:null,sessionId:Oe(),postBody:null,tenantId:p.tenantId,error:(0,f.aw)(p,"no-auth-event")}}(d,v,y);yield function Be(p,d){return mt()._set(vt(p),d)}(d,L);const K=yield function ge(p,d,h){return ne.apply(this,arguments)}(d,L,h),ie=yield function Lt(p){const{cordova:d}=X();return new Promise(h=>{d.plugins.browsertab.isAvailable(v=>{let y=null;v?d.plugins.browsertab.openUrl(p):y=d.InAppBrowser.open(p,(0,f.av)()?"_blank":"_system","location=yes"),h(y)})})}(K);return function En(p,d,h){return pt.apply(this,arguments)}(d,k,ie)})()}_isIframeWebStorageSupported(d,h){throw new Error("Method not implemented.")}_originValidation(d){const h=d._key();return this.originValidationPromises[h]||(this.originValidationPromises[h]=function ue(p){return u.apply(this,arguments)}(d)),this.originValidationPromises[h]}attachCallbackListeners(d,h){const{universalLinks:v,handleOpenURL:y,BuildInfo:b}=X(),k=setTimeout((0,T.Z)(function*(){yield Ut(d),h.onEvent(it())}),500),L=function(){var he=(0,T.Z)(function*(x){clearTimeout(k);const Ae=yield Ut(d);let Ee=null;Ae&&x?.url&&(Ee=function tt(p,d){var h,v;const y=function nt(p){const d=Ve(p),h=d.link?decodeURIComponent(d.link):void 0,v=Ve(h).link,y=d.deep_link_id?decodeURIComponent(d.deep_link_id):void 0;return Ve(y).link||y||v||h||p}(d);if(y.includes("/__/auth/callback")){const b=Ve(y),k=b.firebaseError?function z(p){try{return JSON.parse(p)}catch{return null}}(decodeURIComponent(b.firebaseError)):null,L=null===(v=null===(h=k?.code)||void 0===h?void 0:h.split("auth/"))||void 0===v?void 0:v[1],K=L?(0,f.aw)(L):null;return K?{type:p.type,eventId:p.eventId,tenantId:p.tenantId,error:K,urlResponse:null,sessionId:null,postBody:null}:{type:p.type,eventId:p.eventId,tenantId:p.tenantId,sessionId:p.sessionId,urlResponse:y,postBody:null}}return null}(Ae,x.url)),h.onEvent(Ee||it())});return function(Ae){return he.apply(this,arguments)}}();typeof v<"u"&&"function"==typeof v.subscribe&&v.subscribe(null,L);const K=y,ie=`${b.packageName.toLowerCase()}://`;X().handleOpenURL=function(){var he=(0,T.Z)(function*(x){if(x.toLowerCase().startsWith(ie)&&L({url:x}),"function"==typeof K)try{K(x)}catch(Ae){console.error(Ae)}});return function(x){return he.apply(this,arguments)}}()}};function it(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:(0,f.aw)("no-auth-event")}}function st(){var p;return(null===(p=self?.location)||void 0===p?void 0:p.protocol)||null}function yt(p=(0,G.z$)()){return!("file:"!==st()&&"ionic:"!==st()&&"capacitor:"!==st()||!p.toLowerCase().match(/iphone|ipad|ipod|android/))}function bn(){try{const p=self.localStorage,d=f.aI();if(p)return p.setItem(d,"1"),p.removeItem(d),!function vi(p=(0,G.z$)()){return function $(){return(0,G.w1)()&&11===document?.documentMode}()||function Sn(p=(0,G.z$)()){return/Edge\/\d+/.test(p)}(p)}()||(0,G.hl)()}catch{return Bt()&&(0,G.hl)()}return!1}function Bt(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function Vt(){return(function rt(){return"http:"===st()||"https:"===st()}()||(0,G.ru)()||yt())&&!function Tn(){return(0,G.b$)()||(0,G.UG)()}()&&bn()&&!Bt()}function Rn(){return yt()&&typeof document<"u"}function Ct(){return(Ct=(0,T.Z)(function*(){return!!Rn()&&new Promise(p=>{const d=setTimeout(()=>{p(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(d),p(!0)})})})).apply(this,arguments)}const J={LOCAL:"local",NONE:"none",SESSION:"session"},ve=f.ax,An="persistence";function Me(p){return He.apply(this,arguments)}function He(){return(He=(0,T.Z)(function*(p){yield p._initializationPromise;const d=Gt(),h=f.aA(An,p.config.apiKey,p.name);d&&d.setItem(h,p._getPersistence())})).apply(this,arguments)}function Gt(){var p;try{return(null===(p=function Ge(){return typeof window<"u"?window:null}())||void 0===p?void 0:p.sessionStorage)||null}catch{return null}}const Pn=f.ax;class ye{constructor(){this.browserResolver=f.az(f.k),this.cordovaResolver=f.az(gi),this.underlyingResolver=null,this._redirectPersistence=f.a,this._completeRedirectFn=f.aB,this._overrideRedirectResult=f.aC}_initialize(d){var h=this;return(0,T.Z)(function*(){return yield h.selectUnderlyingResolver(),h.assertedUnderlyingResolver._initialize(d)})()}_openPopup(d,h,v,y){var b=this;return(0,T.Z)(function*(){return yield b.selectUnderlyingResolver(),b.assertedUnderlyingResolver._openPopup(d,h,v,y)})()}_openRedirect(d,h,v,y){var b=this;return(0,T.Z)(function*(){return yield b.selectUnderlyingResolver(),b.assertedUnderlyingResolver._openRedirect(d,h,v,y)})()}_isIframeWebStorageSupported(d,h){this.assertedUnderlyingResolver._isIframeWebStorageSupported(d,h)}_originValidation(d){return this.assertedUnderlyingResolver._originValidation(d)}get _shouldInitProactively(){return Rn()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Pn(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var d=this;return(0,T.Z)(function*(){if(d.underlyingResolver)return;const h=yield function yi(){return Ct.apply(this,arguments)}();d.underlyingResolver=h?d.cordovaResolver:d.browserResolver})()}}function Ht(p){return p.unwrap()}function xn(p){return $t(p)}function $t(p){const{_tokenResponse:d}=p instanceof G.ZR?p.customData:p;if(!d)return null;if(!(p instanceof G.ZR)&&"temporaryProof"in d&&"phoneNumber"in d)return f.P.credentialFromResult(p);const h=d.providerId;if(!h||h===f.o.PASSWORD)return null;let v;switch(h){case f.o.GOOGLE:v=f.Q;break;case f.o.FACEBOOK:v=f.N;break;case f.o.GITHUB:v=f.T;break;case f.o.TWITTER:v=f.W;break;default:const{oauthIdToken:y,oauthAccessToken:b,oauthTokenSecret:k,pendingToken:L,nonce:K}=d;return b||k||y||L?L?h.startsWith("saml.")?f.aL._create(h,L):f.J._fromParams({providerId:h,signInMethod:h,pendingToken:L,idToken:y,accessToken:b}):new f.U(h).credential({idToken:y,accessToken:b,rawNonce:K}):null}return p instanceof G.ZR?v.credentialFromError(p):v.credentialFromResult(p)}function Y(p,d){return d.catch(h=>{throw h instanceof G.ZR&&function zt(p,d){var h;const v=null===(h=d.customData)||void 0===h?void 0:h._tokenResponse;if("auth/multi-factor-auth-required"===d?.code)d.resolver=new Dn(p,f.an(p,d));else if(v){const y=$t(d),b=d;y&&(b.credential=y,b.tenantId=v.tenantId||void 0,b.email=v.email||void 0,b.phoneNumber=v.phoneNumber||void 0)}}(p,h),h}).then(h=>{const y=h.user;return{operationType:h.operationType,credential:xn(h),additionalUserInfo:f.al(h),user:Ce.getOrCreate(y)}})}function ot(p,d){return Qt.apply(this,arguments)}function Qt(){return(Qt=(0,T.Z)(function*(p,d){const h=yield d;return{verificationId:h.verificationId,confirm:v=>Y(p,h.confirm(v))}})).apply(this,arguments)}class Dn{constructor(d,h){this.resolver=h,this.auth=function kn(p){return p.wrapped()}(d)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(d){return Y(Ht(this.auth),this.resolver.resolveSignIn(d))}}class Ce{constructor(d){this._delegate=d,this.multiFactor=f.ao(d)}static getOrCreate(d){return Ce.USER_MAP.has(d)||Ce.USER_MAP.set(d,new Ce(d)),Ce.USER_MAP.get(d)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(d){return this._delegate.getIdTokenResult(d)}getIdToken(d){return this._delegate.getIdToken(d)}linkAndRetrieveDataWithCredential(d){return this.linkWithCredential(d)}linkWithCredential(d){var h=this;return(0,T.Z)(function*(){return Y(h.auth,f.Z(h._delegate,d))})()}linkWithPhoneNumber(d,h){var v=this;return(0,T.Z)(function*(){return ot(v.auth,f.l(v._delegate,d,h))})()}linkWithPopup(d){var h=this;return(0,T.Z)(function*(){return Y(h.auth,f.d(h._delegate,d,ye))})()}linkWithRedirect(d){var h=this;return(0,T.Z)(function*(){return yield Me(f.aE(h.auth)),f.g(h._delegate,d,ye)})()}reauthenticateAndRetrieveDataWithCredential(d){return this.reauthenticateWithCredential(d)}reauthenticateWithCredential(d){var h=this;return(0,T.Z)(function*(){return Y(h.auth,f._(h._delegate,d))})()}reauthenticateWithPhoneNumber(d,h){return ot(this.auth,f.r(this._delegate,d,h))}reauthenticateWithPopup(d){return Y(this.auth,f.e(this._delegate,d,ye))}reauthenticateWithRedirect(d){var h=this;return(0,T.Z)(function*(){return yield Me(f.aE(h.auth)),f.h(h._delegate,d,ye)})()}sendEmailVerification(d){return f.ab(this._delegate,d)}unlink(d){var h=this;return(0,T.Z)(function*(){return yield f.ak(h._delegate,d),h})()}updateEmail(d){return f.ag(this._delegate,d)}updatePassword(d){return f.ah(this._delegate,d)}updatePhoneNumber(d){return f.u(this._delegate,d)}updateProfile(d){return f.af(this._delegate,d)}verifyBeforeUpdateEmail(d,h){return f.ac(this._delegate,d,h)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Ce.USER_MAP=new WeakMap;const Fe=f.ax;let Et=(()=>{class p{constructor(h,v){if(this.app=h,v.isInitialized())return this._delegate=v.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:y}=h.options;Fe(y,"invalid-api-key",{appName:h.name}),Fe(y,"invalid-api-key",{appName:h.name});const b=typeof window<"u"?ye:void 0;this._delegate=v.initialize({options:{persistence:Ei(y,h.name),popupRedirectResolver:b}}),this._delegate._updateErrorMap(f.B),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Ce.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(h){this._delegate.languageCode=h}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(h){this._delegate.tenantId=h}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(h,v){f.G(this._delegate,h,v)}applyActionCode(h){return f.a2(this._delegate,h)}checkActionCode(h){return f.a3(this._delegate,h)}confirmPasswordReset(h,v){return f.a1(this._delegate,h,v)}createUserWithEmailAndPassword(h,v){var y=this;return(0,T.Z)(function*(){return Y(y._delegate,f.a5(y._delegate,h,v))})()}fetchProvidersForEmail(h){return this.fetchSignInMethodsForEmail(h)}fetchSignInMethodsForEmail(h){return f.aa(this._delegate,h)}isSignInWithEmailLink(h){return f.a8(this._delegate,h)}getRedirectResult(){var h=this;return(0,T.Z)(function*(){Fe(Vt(),h._delegate,"operation-not-supported-in-this-environment");const v=yield f.j(h._delegate,ye);return v?Y(h._delegate,Promise.resolve(v)):{credential:null,user:null}})()}addFrameworkForLogging(h){!function mi(p,d){(0,f.aE)(p)._logFramework(d)}(this._delegate,h)}onAuthStateChanged(h,v,y){const{next:b,error:k,complete:L}=wt(h,v,y);return this._delegate.onAuthStateChanged(b,k,L)}onIdTokenChanged(h,v,y){const{next:b,error:k,complete:L}=wt(h,v,y);return this._delegate.onIdTokenChanged(b,k,L)}sendSignInLinkToEmail(h,v){return f.a7(this._delegate,h,v)}sendPasswordResetEmail(h,v){return f.a0(this._delegate,h,v||void 0)}setPersistence(h){var v=this;return(0,T.Z)(function*(){let y;switch(function Ci(p,d){ve(Object.values(J).includes(d),p,"invalid-persistence-type"),(0,G.b$)()?ve(d!==J.SESSION,p,"unsupported-persistence-type"):(0,G.UG)()?ve(d===J.NONE,p,"unsupported-persistence-type"):Bt()?ve(d===J.NONE||d===J.LOCAL&&(0,G.hl)(),p,"unsupported-persistence-type"):ve(d===J.NONE||bn(),p,"unsupported-persistence-type")}(v._delegate,h),h){case J.SESSION:y=f.a;break;case J.LOCAL:y=(yield f.az(f.i)._isAvailable())?f.i:f.b;break;case J.NONE:y=f.L;break;default:return f.as("argument-error",{appName:v._delegate.name})}return v._delegate.setPersistence(y)})()}signInAndRetrieveDataWithCredential(h){return this.signInWithCredential(h)}signInAnonymously(){return Y(this._delegate,f.X(this._delegate))}signInWithCredential(h){return Y(this._delegate,f.Y(this._delegate,h))}signInWithCustomToken(h){return Y(this._delegate,f.$(this._delegate,h))}signInWithEmailAndPassword(h,v){return Y(this._delegate,f.a6(this._delegate,h,v))}signInWithEmailLink(h,v){return Y(this._delegate,f.a9(this._delegate,h,v))}signInWithPhoneNumber(h,v){return ot(this._delegate,f.s(this._delegate,h,v))}signInWithPopup(h){var v=this;return(0,T.Z)(function*(){return Fe(Vt(),v._delegate,"operation-not-supported-in-this-environment"),Y(v._delegate,f.c(v._delegate,h,ye))})()}signInWithRedirect(h){var v=this;return(0,T.Z)(function*(){return Fe(Vt(),v._delegate,"operation-not-supported-in-this-environment"),yield Me(v._delegate),f.f(v._delegate,h,ye)})()}updateCurrentUser(h){return this._delegate.updateCurrentUser(h)}verifyPasswordResetCode(h){return f.a4(this._delegate,h)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return p.Persistence=J,p})();function wt(p,d,h){let v=p;"function"!=typeof p&&({next:v,error:d,complete:h}=p);const y=v;return{next:k=>y(k&&Ce.getOrCreate(k)),error:d,complete:h}}function Ei(p,d){const h=function Nn(p,d){const h=Gt();if(!h)return[];const v=f.aA(An,p,d);switch(h.getItem(v)){case J.NONE:return[f.L];case J.LOCAL:return[f.i,f.a];case J.SESSION:return[f.a];default:return[]}}(p,d);if(typeof self<"u"&&!h.includes(f.i)&&h.push(f.i),typeof window<"u")for(const v of[f.b,f.a])h.includes(v)||h.push(v);return h.includes(f.L)||h.push(f.L),h}class Kt{constructor(){this.providerId="phone",this._delegate=new f.P(Ht(et.Z.auth()))}static credential(d,h){return f.P.credential(d,h)}verifyPhoneNumber(d,h){return this._delegate.verifyPhoneNumber(d,h)}unwrap(){return this._delegate}}Kt.PHONE_SIGN_IN_METHOD=f.P.PHONE_SIGN_IN_METHOD,Kt.PROVIDER_ID=f.P.PROVIDER_ID;const On=f.ax;class wi{constructor(d,h,v=et.Z.app()){var y;On(null===(y=v.options)||void 0===y?void 0:y.apiKey,"invalid-api-key",{appName:v.name}),this._delegate=new f.R(d,h,v.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function Ti(p){p.INTERNAL.registerComponent(new E.wA("auth-compat",d=>{const h=d.getProvider("app-compat").getImmediate(),v=d.getProvider("auth");return new Et(h,v)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:f.A.EMAIL_SIGNIN,PASSWORD_RESET:f.A.PASSWORD_RESET,RECOVER_EMAIL:f.A.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:f.A.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:f.A.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:f.A.VERIFY_EMAIL}},EmailAuthProvider:f.M,FacebookAuthProvider:f.N,GithubAuthProvider:f.T,GoogleAuthProvider:f.Q,OAuthProvider:f.U,SAMLAuthProvider:f.V,PhoneAuthProvider:Kt,PhoneMultiFactorGenerator:f.m,RecaptchaVerifier:wi,TwitterAuthProvider:f.W,Auth:Et,AuthCredential:f.H,Error:G.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),p.registerVersion("@firebase/auth-compat","0.3.0")}(et.Z)}}]);